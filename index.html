<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="google-site-verification" content="8SyBOdC5YhaXDqfNYGfzP1EZbb0iQWABpkImmZHXG30" />
    
    <title>Medicome - Simulateur de Cas Cliniques pour les √©tudiants en M√©decine</title>
    
    <meta name="description" content="Entra√Ænez-vous au diagnostic m√©dical avec Medicome. Une IA interactive pour r√©viser la s√©miologie, les pathologies et r√©ussir vos examens de m√©decine (Externat, ECN, EDN).">
    
    <meta name="keywords" content="diagnostic m√©dical, cas cliniques, s√©miologie, r√©vision m√©decine, ECN, EDN, externat, intelligence artificielle sant√©, quiz m√©dical">
    
    <meta property="og:title" content="Medicome - L'IA de Diagnostic M√©dical">
    <meta property="og:description" content="Testez vos connaissances : l'IA devine la pathologie ou c'est vous qui la d√©fiez.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://medicome.fr/">
    <link rel="canonical" href="https://medicome.fr/" />
    <link rel="icon" href="favicon.png">

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        /* Classe utilitaire pour cacher du texte aux humains mais le montrer √† Google */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* ================= STYLE CHROME / DARK GLOSS ================= */
        :root {
          --bg-dark: #020b16;
          --bg-light: #1e3c72;
          --glass-bg: rgba(13, 25, 48, 0.75);
          --glass-border: rgba(100, 200, 255, 0.15);
          --accent: #00d2ff;
          --accent-glow: rgba(0, 210, 255, 0.4);
          --text-main: #ffffff;
          --text-muted: #b0c4de;
          --success: #00ff9d;
          --error: #ff4d4d;
          --info: #60a5fa;
          --gold: #ffd700;
        }

        /* RESET & BASE */
        * { box-sizing: border-box; margin: 0; padding: 0; scroll-behavior: smooth; }
        
        body {
          font-family: 'Inter', sans-serif;
          background: radial-gradient(circle at 50% 0%, var(--bg-light), var(--bg-dark) 80%);
          background-attachment: fixed;
          color: var(--text-main);
          min-height: 100vh;
          display: flex;
          flex-direction: column;
        }

        /* HEADER */
        header {
          display: flex;
          justify-content: space-between;
          padding: 10px 24px;
          background: rgba(2, 11, 22, 0.8);
          backdrop-filter: blur(15px);
          -webkit-backdrop-filter: blur(15px);
          align-items: center;
          border-bottom: 1px solid var(--glass-border);
          position: sticky; top: 0; z-index: 100;
          box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }

        .brand { 
            display: flex; align-items: center; gap: 12px; 
            cursor: pointer; 
        }
        
        .logo-img {
            height: 70px; 
            width: auto;
            filter: drop-shadow(0 0 8px var(--accent-glow));
            transition: transform 0.3s;
        }
        .brand:hover .logo-img { transform: scale(1.05); }
        
        .top-right { display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
        
        .pseudo { 
            color:var(--accent); font-weight:600; padding:6px 12px; 
            background: rgba(0, 210, 255, 0.05); 
            border: 1px solid var(--glass-border);
            border-radius:20px; cursor:pointer; font-size: 14px; 
            display: flex; align-items: center; gap: 8px;
        }

        /* BUTTONS & LINKS */
        .link {
          background: rgba(255,255,255,0.03);
          border:1px solid rgba(255,255,255,0.1);
          color: var(--text-muted);
          padding:8px 16px;
          border-radius:8px;
          cursor:pointer;
          transition:all 0.3s;
          font-size:14px;
        }
        .link:hover { 
            background: rgba(255,255,255,0.1); 
            color: white; 
            border-color: var(--accent);
            box-shadow: 0 0 10px var(--accent-glow);
        }

        /* CARDS */
        main { flex:1; max-width:1000px; width:100%; margin:0 auto; padding:30px 20px; display:flex; flex-direction:column; align-items:center; }
        
        .card { 
            background: var(--glass-bg); 
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            padding:32px; 
            border-radius:20px; 
            box-shadow: 0 15px 35px rgba(0,0,0,0.6), inset 0 0 0 1px var(--glass-border); 
            margin-bottom:16px; width:100%; max-width:600px; 
            transition: transform 0.3s ease;
            animation: fadeIn 0.5s ease-out;
        }
        
        .card h2 { margin-bottom:20px; font-size:26px; text-align:center; color: white; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
        .card h3 { margin-bottom:16px; font-size:22px; text-align:center; color: var(--accent); }

        /* INPUTS */
        .input, select, textarea { 
            width:100%; padding:14px; border-radius:10px; 
            border:1px solid rgba(255,255,255,0.15); 
            background: rgba(0,0,0,0.3); 
            color: var(--text-main); 
            margin-top:8px; margin-bottom:12px; font-size:14px; 
            transition:all 0.3s; font-family: 'Inter', sans-serif;
        }
        textarea { resize: vertical; min-height: 100px; }
        .input:focus, select:focus, textarea:focus { 
            outline:none; border-color:var(--accent); 
            background: rgba(0,0,0,0.5); 
            box-shadow: 0 0 15px var(--accent-glow);
        }

        /* ACTION BUTTONS */
        .btn { 
            background: linear-gradient(135deg, #0072ff 0%, #00c6ff 100%);
            border:none; padding:14px 24px; border-radius:12px; 
            color: #000; cursor:pointer; font-weight:700; font-size:15px; 
            transition:all 0.3s; 
            box-shadow: 0 4px 15px rgba(0, 114, 255, 0.4);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .btn:hover { 
            transform:translateY(-2px); 
            box-shadow: 0 6px 20px rgba(0, 114, 255, 0.6), inset 0 0 0 2px rgba(255,255,255,0.3);
        }
        
        .btn-success { background: linear-gradient(135deg, #00b09b 0%, #96c93d 100%); color: #022015; box-shadow: 0 4px 15px rgba(0, 176, 155, 0.4); }
        .btn-success:hover { box-shadow: 0 6px 20px rgba(0, 176, 155, 0.6); }
        
        .btn-error { background: linear-gradient(135deg, #cb2d3e 0%, #ef473a 100%); color: white; box-shadow: 0 4px 15px rgba(203, 45, 62, 0.4); }
        .btn-error:hover { box-shadow: 0 6px 20px rgba(203, 45, 62, 0.6); }

        .btn-code { 
            background: transparent !important; 
            border: 1px solid var(--accent) !important; 
            color: var(--accent) !important;
            box-shadow: none !important;
        }
        .btn-code:hover { background: rgba(0, 210, 255, 0.1) !important; box-shadow: 0 0 15px var(--accent-glow) !important; }

        .btn-back {
            background: rgba(255, 255, 255, 0.1); color: #ccc;
            border: 1px solid rgba(255, 255, 255, 0.2); padding: 10px 20px;
            border-radius: 10px; cursor: pointer; font-size: 14px; font-weight: 600;
            transition: all 0.2s;
        }
        .btn-back:hover { background: rgba(255, 255, 255, 0.2); color: white; }

        /* ELEMENTS */
        .center { text-align:center; display:flex; flex-direction:column; align-items:center; }
        .button-group { display:flex; gap:16px; justify-content:center; flex-wrap:wrap; margin-top:12px; width: 100%; }
        .small { opacity:0.6; font-size:13px; color:var(--text-muted); margin-top:12px; text-align:center; }
        
        .question-text { 
            font-size:22px; text-align:center; line-height:1.6; padding:24px; 
            background: linear-gradient(90deg, rgba(0,210,255,0.05) 0%, rgba(0,210,255,0) 100%);
            border-radius:12px; border-left:4px solid var(--accent); 
            word-break:break-word; width: 100%; margin-bottom: 20px;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.2);
        }

        /* REVIEWS SECTION */
        .reviews-container {
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; width: 100%;
        }
        .review-card {
            background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px; padding: 15px; text-align: left;
        }
        .review-header { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
        .review-avatar { width: 30px; height: 30px; background: var(--accent); border-radius: 50%; display:flex; align-items:center; justify-content:center; font-weight:bold; color:black; font-size:12px;}
        .review-name { font-weight: 600; font-size: 14px; color: white; }
        .review-stars { color: #FFD700; font-size: 12px; }
        .review-text { font-size: 13px; color: var(--text-muted); font-style: italic; }

        /* GLOSSAIRE */
        .glossary-wrapper { display: flex; align-items: flex-start; gap: 20px; width: 100%; max-width: 1000px; position: relative; }
        .alphabet-sidebar { position: sticky; top: 100px; display: flex; flex-direction: column; gap: 2px; background: rgba(0, 0, 0, 0.4); padding: 10px; border-radius: 20px; border: 1px solid var(--glass-border); max-height: 80vh; overflow-y: auto; flex-shrink: 0; }
        .alpha-link { color: var(--text-muted); text-decoration: none; font-size: 12px; font-weight: 700; padding: 2px 8px; border-radius: 4px; transition: all 0.2s; text-align: center; }
        .alpha-link:hover { color: white; background: rgba(255,255,255,0.1); }
        .alpha-link.active { color: var(--accent); background: rgba(0, 210, 255, 0.1); }
        .alpha-link.disabled { opacity: 0.2; cursor: default; pointer-events: none; }
        .glossary-content { flex: 1; width: 100%; }
        .search-container { width: 100%; max-width: 1000px; margin-bottom: 20px; }
        .search-input { width: 100%; padding: 16px; border-radius: 12px; border: 1px solid var(--glass-border); background: rgba(0,0,0,0.4); color: white; font-size: 16px; backdrop-filter: blur(5px); }
        .search-input:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 15px var(--accent-glow); }
        .letter-header { font-size: 28px; font-weight: 800; color: var(--accent); border-bottom: 2px solid rgba(255,255,255,0.1); margin-top: 40px; margin-bottom: 20px; padding-bottom: 5px; scroll-margin-top: 110px; }
        .letter-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; }
        .patho-card { background: rgba(255, 255, 255, 0.03); padding:24px; border-radius:16px; border:1px solid rgba(255,255,255,0.05); transition:all 0.3s; cursor:pointer; }
        .patho-card:hover { transform:translateY(-5px); border-color:var(--accent); background: rgba(0, 210, 255, 0.05); box-shadow: 0 10px 30px rgba(0,0,0,0.5), 0 0 20px var(--accent-glow); }
        .patho-name { font-size:18px; font-weight:700; color:var(--accent); margin-bottom:8px; }
        .patho-desc { font-size:14px; color:rgba(255,255,255,0.7); line-height:1.5; }

        /* MASTERY PROFILE GRID */
        .mastery-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 12px; width: 100%; margin-top: 20px;
        }
        .mastery-item {
            background: rgba(0,0,0,0.2); border-radius: 10px; padding: 15px; text-align: center;
            border: 1px solid rgba(255,255,255,0.05); transition: all 0.3s;
            display: flex; flex-direction: column; align-items: center; gap: 8px;
        }
        .mastery-item.locked {
            opacity: 0.5; filter: grayscale(1); border-style: dashed;
        }
        .mastery-item.unlocked {
            border: 1px solid var(--success); background: rgba(0, 255, 157, 0.05);
        }
        .mastery-item.master {
            border: 1px solid var(--gold); background: rgba(255, 215, 0, 0.1);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.2);
        }
        .mastery-icon { font-size: 24px; }
        .mastery-name { font-size: 13px; font-weight: 600; color: white; }
        .mastery-count { font-size: 11px; color: var(--text-muted); }

        /* ALERTS & STATS */
        .alert { padding:14px; border-radius:10px; margin:12px 0; font-size:14px; width: 100%; text-align: center; font-weight: 500;}
        .alert-success { background: rgba(0, 255, 157, 0.1); border:1px solid var(--success); color:var(--success); box-shadow: 0 0 15px rgba(0, 255, 157, 0.2); }
        .alert-error { background: rgba(255, 77, 77, 0.1); border:1px solid var(--error); color:var(--error); box-shadow: 0 0 15px rgba(255, 77, 77, 0.2); }
        .stat-box { background: rgba(0,0,0,0.3); padding:20px; border-radius:12px; margin:10px 0; border: 1px solid rgba(255,255,255,0.05); text-align:center; }
        .stat-number { font-size:36px; font-weight:700; color:white; text-shadow: 0 0 10px rgba(255,255,255,0.3); }
        .diagnostic-result { background: rgba(0, 210, 255, 0.1); padding:30px; border-radius:20px; margin:20px 0; border:2px solid var(--accent); text-align:center; box-shadow: 0 0 30px var(--accent-glow); }
        .diagnostic-name { font-size:32px; font-weight:700; color:white; margin-bottom:12px; text-shadow: 0 0 10px var(--accent); }
        .score-badge { display:inline-block; background: var(--accent); color: #000; font-weight: 700; padding:6px 14px; border-radius:20px; font-size:14px; margin-top:12px; }
        .result-item { padding:12px 16px; border-radius:10px; margin-bottom:8px; background: rgba(0,0,0,0.3); display:flex; justify-content:space-between; align-items:center; border: 1px solid rgba(255,255,255,0.05); }
        .result-correct { border-left:4px solid var(--success); }
        .result-missing { border-left:4px solid #f59e0b; }
        .result-error { border-left:4px solid var(--error); }
        .result-neutral { border-left:4px solid var(--info); background: rgba(96, 165, 250, 0.1); }
        
        @keyframes spin { 100% { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }

        /* FOOTER & SOCIALS */
        footer { 
            text-align:center; padding:30px 20px; 
            background: rgba(0,0,0,0.5); font-size:13px; 
            border-top: 1px solid rgba(255,255,255,0.05); 
            display: flex; flex-direction: column; align-items: center; gap: 15px;
        }
        .social-links { display: flex; gap: 20px; margin-bottom: 10px; }
        .social-link { 
            display: flex; align-items: center; justify-content: center;
            width: 40px; height: 40px;
            background: rgba(255,255,255,0.05);
            border-radius: 50%;
            transition: all 0.3s;
            text-decoration: none;
        }
        .social-link:hover { 
            background: rgba(0, 210, 255, 0.1); 
            transform: scale(1.1); 
            box-shadow: 0 0 15px var(--accent-glow);
        }
        .social-icon { width: 20px; height: 20px; fill: var(--text-muted); transition: fill 0.3s; }
        .social-link:hover .social-icon { fill: var(--accent); }
        
        .footer-nav { display: flex; gap: 20px; flex-wrap: wrap; justify-content: center;}
        .footer-link { color: var(--text-muted); text-decoration: none; font-weight: 500; transition: color 0.2s; cursor: pointer;}
        .footer-link:hover { color: var(--accent); text-decoration: underline; }

        @media (max-width:600px){
            .button-group{flex-direction:column;width:100%;}
            .btn,.link{width:100%;}
            .glossary-wrapper { flex-direction: column; }
            .alphabet-sidebar { flex-direction: row; flex-wrap: wrap; width: 100%; position: static; justify-content: center; margin-bottom: 20px; max-height: none; }
            .alpha-link { padding: 5px 10px; font-size: 14px; }
            .reviews-container { grid-template-columns: 1fr; }
            .mastery-grid { grid-template-columns: repeat(3, 1fr); }
        }
    </style>
</head>
<body>

    <header>
        <div class="brand" id="brandLogo">
            <img src="logo.png" alt="Medicome Logo - Simulateur Diagnostic M√©dical" class="logo-img">
            <h1 class="sr-only">Medicome : Entra√Ænement au Diagnostic M√©dical et S√©miologie</h1>
        </div>
        
        <div class="top-right">
            <button id="homeBtn" class="link" style="display:none;">Accueil</button>
            <div id="pseudoBox" class="pseudo" style="display:none;">Utilisateur</div>
            <button id="logoutBtn" class="link" style="display:none;">D√©connexion</button>
        </div>
    </header>

    <main id="app">
        <div class="center">
            <div style="font-size: 40px; animation: spin 1s infinite linear; margin-bottom: 20px;">‚öôÔ∏è</div>
            <div class="small">Chargement du noyau m√©dical...</div>
            
            <div style="opacity:0; height:1px; overflow:hidden;">
                <h2>Application de R√©vision M√©dicale pour Externes</h2>
                <p>Bienvenue sur Medicome, le simulateur de cas cliniques interactif.</p>
                <p>Pr√©parez vos ECN, EDN et examens de m√©decine gr√¢ce √† notre intelligence artificielle qui vous challenge sur :</p>
                <ul>
                    <li>La s√©miologie m√©dicale</li>
                    <li>Le diagnostic diff√©rentiel</li>
                    <li>Les pathologies cardio, pneumo, neuro et digestives</li>
                </ul>
            </div>
        </div>
    </main>

    <footer>
        <div class="social-links">
            <a href="https://instagram.com/medicome.fr" target="_blank" class="social-link" title="Instagram">
                <svg class="social-icon" viewBox="0 0 24 24"><path d="M7.8,2H16.2C19.4,2 22,4.6 22,7.8V16.2A5.8,5.8 0 0,1 16.2,22H7.8C4.6,22 2,19.4 2,16.2V7.8A5.8,5.8 0 0,1 7.8,2M7.6,4A3.6,3.6 0 0,0 4,7.6V16.4C4,18.39 5.61,20 7.6,20H16.4A3.6,3.6 0 0,0 20,16.4V7.6C20,5.61 18.39,4 16.4,4H7.6M17.25,5.5A1.25,1.25 0 0,1 18.5,6.75A1.25,1.25 0 0,1 17.25,8A1.25,1.25 0 0,1 16,6.75A1.25,1.25 0 0,1 17.25,5.5M12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9Z" /></svg>
            </a>
            <a href="https://www.tiktok.com/@medicome.fr" target="_blank" class="social-link" title="TikTok">
                <svg class="social-icon" viewBox="0 0 24 24"><path d="M12.5 3.5v10.55c0 1.9-1.55 3.45-3.45 3.45S5.6 15.95 5.6 14.05c0-1.9 1.55-3.45 3.45-3.45 0.3 0 0.6 0.05 0.85 0.15V7.4c-0.25-0.1-0.55-0.15-0.85-0.15-3.8 0-6.9 3.1-6.9 6.9s3.1 6.9 6.9 6.9c3.8 0 6.9-3.1 6.9-6.9V7.6c1.7 1.2 3.8 1.9 6.05 1.9v-3.75c-2.15 0-4.05-0.9-5.3-2.3H12.5z"/></svg>
            </a>
            <a href="https://x.com/medicome_fr" target="_blank" class="social-link" title="X (Twitter)">
                <svg class="social-icon" viewBox="0 0 24 24"><path d="M22.46,6C21.69,6.35 20.86,6.58 20,6.69C20.88,6.16 21.56,5.32 21.88,4.31C21.05,4.81 20.13,5.16 19.16,5.36C18.37,4.5 17.26,4 16,4C13.65,4 11.73,5.92 11.73,8.29C11.73,8.63 11.77,8.96 11.84,9.27C8.28,9.09 5.11,7.38 3,4.79C2.63,5.42 2.42,6.16 2.42,6.94C2.42,8.43 3.17,9.75 4.33,10.5C3.62,10.5 2.96,10.3 2.38,10C2.38,10 2.38,10.03 2.38,10.05C2.38,12.11 3.86,13.85 5.82,14.24C5.46,14.34 5.08,14.39 4.69,14.39C4.42,14.39 4.15,14.36 3.89,14.31C4.43,16 6,17.26 7.89,17.29C6.43,18.45 4.58,19.13 2.56,19.13C2.22,19.13 1.88,19.11 1.54,19.07C3.44,20.29 5.7,21 8.12,21C16,21 20.33,14.46 20.33,8.79C20.33,8.6 20.33,8.42 20.32,8.23C21.16,7.63 21.88,6.87 22.46,6Z" /></svg>
            </a>
        </div>
        <div class="footer-nav">
            <span class="footer-link" onclick="window.scrollTo(0,0)">Haut de page</span>
            <span class="footer-link" id="reviewsLink">Avis Utilisateurs</span>
            <span class="footer-link" id="contactLink">Nous Contacter</span>
        </div>
        <div style="margin-top:10px; opacity:0.6;">Medicome ¬© 2025 - Outil p√©dagogique</div>
    </footer>

    <script type="module">
        if (window.location.hostname.includes("github.io")) {
            window.location.href = "https://medicome.fr";
        }

        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, updateProfile, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, addDoc, collection } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // --- GESTION NAVIGATION NAVIGATEUR ---
        function navigateTo(view) {
            if (history.state?.view !== view) {
                history.pushState({view: view}, "", "#" + view);
            }
        }

        window.onpopstate = function(event) {
            const view = event.state?.view || 'home';
            if (view === 'home') renderHome(false);
            else if (view === 'glossary') renderGlossary(false);
            else if (view === 'setup') renderDemographics(false);
            else if (view === 'profile') renderProfile(false);
            else if (view === 'reviews') renderReviews(false);
            else if (view === 'contact') renderContact(false);
            else renderHome(false);
        };

        // --- LOGIQUE D'ENTONNOIR ---
        const REFINEMENTS = {
            "douleur_abdominale": ["douleur_fosse_iliaque_droite", "douleur_hypocondre_droit", "douleur_fosse_iliaque_gauche", "douleur_epigastrique", "douleur_transfixiante_dos", "douleur_bas_ventre", "douleur_pelvienne", "douleur_abdominale_diffuse", "crampes_abdominales", "douleur_abdominale_intermittente", "douleur_sus_pubienne", "troubles_transit"],
            "douleur_thoracique": ["douleur_thoracique_oppressive", "douleur_thoracique_dechirante", "douleur_thoracique_cot√©", "douleur_basithoracique", "douleur_inspiration", "douleur_thoracique_point_cote"],
            "douleur_dos": ["douleur_lombaire_brutale", "douleur_lombaire_unilaterale", "douleur_lombaire", "douleur_bas_dos", "douleur_bas_dos_nuit", "douleur_dos_os", "douleur_dos_brutale"],
            "douleur_membre_traumatisme": ["impossibilite_marcher", "douleur_poignet", "chute_recente", "jambe_froide_pale", "douleur_articulaire_intense", "douleur_gros_orteil", "douleur_jambe_brutale_intense", "douleur_aine_hanche", "douleur_mains", "douleur_talon", "fourmillements_doigts"],
            "dyspnee": ["dyspnee_effort", "orthopnee_dyspnee_couchee", "dyspnee_brutale", "dyspnee_sifflante", "essoufflement_aggrave", "gene_respiratoire"],
            "toux": ["toux_seche", "toux_grasse", "toux_sanglante", "chant_du_coq", "toux_chronique", "toux_nuit"],
            "troubles_visuels": ["vision_floue", "vision_double", "baisse_vision_brutale", "amputation_champ_visuel", "eclairs_lumineux", "mouches_devant_yeux", "vision_centrale_floue", "vision_double_un_oeil", "trouble_vision_flou"],
            "troubles_neuro": ["paralysie_unilaterale", "troubles_parole_aphasie", "asymetrie_visage", "perte_sensibilite", "perte_equilibre", "tremblement_repos", "lenteur_mouvements", "machoire_bloquee", "corps_raide_contracte", "paralysie_descend_tete_vers_pieds", "paralysie_monte_pieds_vers_tete", "perte_connaissance"],
            "cephalees": ["cephalees_intenses", "cephalees_explosives_brutales", "mal_tete_unilateral"],
            "anomalie_peau": ["plaques_rouges", "vesicules_bulles", "demangeaisons", "grain_beaute_suspect", "tache_noire", "jambe_rouge", "purpura", "taches_rouges_jambes", "taches_rouges_peau", "tache_rouge_s_etend_peau", "plaques_rouges_croutes", "perle_translucide_peau", "croute_ne_guerit_pas", "boutons_bulles_corps", "taches_peau_purpura", "eruption_boutons_corps", "eruption_corps", "peau_aspect_granite", "boule_aine_douloureuse_dure"],
            "trouble_psy": ["tristesse_permanente", "delire_paranoiaque", "hallucinations", "perte_memoire", "agitation", "excitation_euphorie", "maigreur_extreme", "ne_se_lave_plus", "oubli_faits_recents", "cherches_ses_mots"],
            "genes_urinaires": ["sang_urines", "brulures_urinaires", "impossibilite_uriner", "regles_tres_abondantes", "douleur_testicule_brutale", "pertes_vaginales_anormales", "sang_urines_rouge", "difficulte_uriner", "urines_abondantes", "urines_mousseuses"]
        };

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(type) {
            if(audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            if (type === 'success') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(523.25, audioCtx.currentTime); 
                osc.frequency.exponentialRampToValueAtTime(1046.5, audioCtx.currentTime + 0.1); 
                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.4);
            } else if (type === 'error') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.3);
            }
        }

        const firebaseConfig = {
            apiKey: "AIzaSyCig9G4gYHU5h642YV1IZxthYm_IXp6vZU",
            authDomain: "medicome-paco.firebaseapp.com",
            projectId: "medicome-paco",
            storageBucket: "medicome-paco.firebasestorage.app",
            messagingSenderId: "332171806096",
            appId: "1:332171806096:web:36889325196a7a718b5f15",
            measurementId: "G-81HJ9DWBMX"
        };

        let app_fb, auth, db;
        try {
            app_fb = initializeApp(firebaseConfig);
            auth = getAuth(app_fb);
            db = getFirestore(app_fb);
        } catch (error) {
            console.error("Erreur Firebase:", error);
        }

        let PATHOLOGIES = [];
        const ACCESS_CODES = [ { code: "SuperCode1", pseudo:"Admin" } ];

        let state = {
            currentUser: null, pseudo: null, 
            progression: { correct: 0, incorrect: 0, streak: 0, mastery: {} },
            isGuest: false, demo:{}, currentSign:null, answers:{}, asked:[], allSigns:[], ranked: [], diagnosticShown:false, previousDiagnostics:[],
            history: [],
            confirmationMode: false, confirmationQueue: [], confirmedPatho: null,
            priorityQueue: []
        };

        async function initApp() {
            try {
                const response = await fetch('./pathologies.json');
                if (!response.ok) throw new Error("Impossible de lire le fichier de donn√©es");
                PATHOLOGIES = await response.json();
                startAuthListener();
                const cLink = document.getElementById('contactLink'); if(cLink) cLink.onclick = () => renderContact();
                const rLink = document.getElementById('reviewsLink'); if(rLink) rLink.onclick = () => renderReviews();
                const brandLogo = document.getElementById('brandLogo'); if(brandLogo) brandLogo.onclick = () => { if(state.pseudo) renderHome(); };
            } catch (err) {
                console.error(err);
            }
        }
        initApp();

        function startAuthListener() {
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    state.currentUser = user; state.isGuest = false;
                    let displayPseudo = user.displayName || user.email.split('@')[0];
                    state.pseudo = displayPseudo;
                    const docSnap = await getDoc(doc(db, "users", user.uid));
                    if (docSnap.exists()) {
                        const data = docSnap.data();
                        if (data.pseudo) state.pseudo = data.pseudo;
                        state.progression = data.progression || { correct: 0, incorrect: 0, streak: 0, mastery: {} };
                    } else { saveProgression(); }
                    updateHeader(); renderHome();
                } else {
                    const savedGuest = localStorage.getItem('medicome_guest_progression');
                    const savedPseudo = localStorage.getItem('medicome_guest_pseudo');
                    if(savedGuest && savedPseudo) {
                        state.isGuest = true; state.pseudo = savedPseudo;
                        state.progression = JSON.parse(savedGuest);
                        updateHeader(); renderHome();
                    } else {
                        renderLogin(); updateHeader();
                    }
                }
            });
        }

        function q(sel){ return document.querySelector(sel); }
        function formatSigneName(sign){ return sign.replace(/_/g,' ').replace(/\b\w/g,c=>c.toUpperCase()); }
        function showAlert(message,type){
            const alertDiv = document.createElement('div');
            alertDiv.className = 'alert alert-' + type;
            alertDiv.textContent = message;
            const app = q('#app');
            if(app){ app.insertBefore(alertDiv,app.firstChild); setTimeout(()=>{ if(alertDiv.parentNode) alertDiv.parentNode.removeChild(alertDiv); },3000); }
        }
        
        function triggerConfetti() { if(window.confetti) window.confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } }); }

        async function saveProgression() {
            if (!state.isGuest && state.currentUser) {
                await setDoc(doc(db, "users", state.currentUser.uid), { progression: state.progression, pseudo: state.pseudo, lastUpdate: new Date() }, { merge: true });
            } else if (state.isGuest) {
                localStorage.setItem('medicome_guest_progression', JSON.stringify(state.progression));
                localStorage.setItem('medicome_guest_pseudo', state.pseudo);
            }
        }

        function updateHeader(){
            const pseudoBox = q("#pseudoBox"); const homeBtn = q("#homeBtn"); const logoutBtn = q("#logoutBtn");
            const currentStreak = state.progression.streak || 0;
            const streakDisplay = currentStreak > 0 ? ` <span style="color:#ff9f43; margin-left:8px;">üî• ${currentStreak}</span>` : '';
            if(state.pseudo){ 
                pseudoBox.innerHTML = state.pseudo + (state.isGuest ? " (Local)" : "") + streakDisplay; 
                pseudoBox.style.display='inline-block'; pseudoBox.onclick= () => renderProfile();
                homeBtn.style.display='inline-block'; logoutBtn.style.display='inline-block';
            } else { 
                pseudoBox.style.display='none'; homeBtn.style.display='none'; logoutBtn.style.display='none';
            }
            homeBtn.onclick= () => renderHome();
            logoutBtn.onclick = () => {
                localStorage.removeItem('medicome_guest_progression'); localStorage.removeItem('medicome_guest_pseudo');
                state.isGuest = false; state.pseudo = null; state.currentUser = null; state.progression = { correct: 0, incorrect: 0, streak: 0, mastery:{} }; 
                signOut(auth).then(() => { renderLogin(); updateHeader(); });
            };
        }

        function renderReviews(track = true) {
            if(track) navigateTo('reviews');
            const app = q('#app'); app.innerHTML='';
            const card = document.createElement('div'); card.className='card center';
            card.innerHTML = `<h2>‚≠ê Avis Utilisateurs</h2><div class="reviews-container">
                <div class="review-card"><div class="review-header"><div class="review-avatar">A</div><div><div class="review-name">Antoine D.</div><div class="review-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div></div></div><div class="review-text">"Super outil pour r√©viser mes cas cliniques avant les partiels."</div></div>
                <div class="review-card"><div class="review-header"><div class="review-avatar">L</div><div><div class="review-name">L√©a B.</div><div class="review-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div></div></div><div class="review-text">"Merci pour cet outil gratuit. √áa m'a sauv√© sur la s√©mio cardio !"</div></div>
            </div>`;
            const btnBack = document.createElement('button'); btnBack.className='btn'; btnBack.textContent='Retour';
            btnBack.style.marginTop = '20px'; btnBack.onclick = () => renderHome();
            card.appendChild(btnBack); app.appendChild(card);
        }

        function renderContact(track = true) {
            if(track) navigateTo('contact');
            const app = q('#app'); app.innerHTML='';
            const card = document.createElement('div'); card.className='card center';
            card.innerHTML = `<h2>‚úâÔ∏è Nous Contacter</h2>`;
            const inputText = document.createElement('textarea'); inputText.className='input'; inputText.placeholder='Votre message...';
            const btnSend = document.createElement('button'); btnSend.className='btn'; btnSend.textContent='Envoyer';
            btnSend.onclick = () => { showAlert("Message envoy√© !", "success"); renderHome(); };
            const btnCancel = document.createElement('button'); btnCancel.className='link'; btnCancel.textContent='Annuler';
            btnCancel.onclick = () => renderHome();
            card.appendChild(inputText); card.appendChild(btnSend); card.appendChild(btnCancel); app.appendChild(card);
        }

        function renderLogin() {
            const app = q('#app'); app.innerHTML='';
            const card = document.createElement('div'); card.className='card center'; card.innerHTML='<h2>‚òÅÔ∏è Connexion</h2>';
            const inEmail = document.createElement('input'); inEmail.placeholder='Email'; inEmail.className='input';
            const inPass = document.createElement('input'); inPass.placeholder='Mot de passe'; inPass.className='input'; inPass.type='password';
            const btnLogin = document.createElement('button'); btnLogin.className='btn'; btnLogin.textContent='Se connecter';
            btnLogin.onclick = async () => { try { await signInWithEmailAndPassword(auth, inEmail.value, inPass.value); } catch (e) { showAlert(e.message, "error"); } };
            const sepCode = document.createElement('div'); sepCode.textContent='‚Äî ou Acc√®s Rapide ‚Äî'; sepCode.className='small'; sepCode.style.margin='16px 0';
            const inputCode = document.createElement('input'); inputCode.placeholder='Cl√© d\'acc√®s'; inputCode.className='input';
            const btnCode = document.createElement('button'); btnCode.className='btn btn-code'; btnCode.textContent='Utiliser une cl√©';
            btnCode.onclick = () => {
                const codeFound = ACCESS_CODES.find(ac => ac.code === inputCode.value);
                if(codeFound) { state.isGuest = true; state.pseudo = codeFound.pseudo; saveProgression(); updateHeader(); renderHome(); }
            };
            card.appendChild(inEmail); card.appendChild(inPass); card.appendChild(btnLogin); card.appendChild(sepCode); card.appendChild(inputCode); card.appendChild(btnCode);
            app.appendChild(card);
        }

        function renderHome(track = true) {
            if(track) navigateTo('home');
            const app = q('#app'); app.innerHTML='';
            const prog = state.progression;
            const card = document.createElement('div'); card.className='card center';
            card.innerHTML = `<h2>üëã Bonjour ${state.pseudo}</h2>
                <div class="stat-box" style="width:100%"><div class="stat-number">${prog.correct + prog.incorrect}</div><div class="stat-label">Cas jou√©s</div></div>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;width:100%;margin-top:12px;">
                    <div class="stat-box" style="background:rgba(0, 255, 157, 0.1); border-color:var(--success)"><div class="stat-number" style="color:var(--success);">${prog.correct}</div><div class="stat-label">R√©ussis</div></div>
                    <div class="stat-box" style="background:rgba(255, 77, 77, 0.1); border-color:var(--error)"><div class="stat-number" style="color:var(--error);">${prog.incorrect}</div><div class="stat-label">√âchecs</div></div>
                </div>`;
            const btnDiag = document.createElement('button'); btnDiag.className='btn'; btnDiag.textContent='ü©∫ Lancer le d√©fi'; btnDiag.style.marginTop='24px'; btnDiag.style.width='100%'; 
            btnDiag.onclick= () => renderDemographics();
            const btnGloss = document.createElement('button'); btnGloss.className='link'; btnGloss.textContent='üìö Glossaire'; btnGloss.onclick= () => renderGlossary();
            const btnProf = document.createElement('button'); btnProf.className='link'; btnProf.textContent='üë§ Profil'; btnProf.onclick= () => renderProfile();
            card.appendChild(btnDiag); card.appendChild(btnGloss); card.appendChild(btnProf); app.appendChild(card);
        }

        function renderProfile(track = true) {
            if(track) navigateTo('profile');
            const app = q('#app'); app.innerHTML='';
            const card = document.createElement('div'); card.className='card center'; card.innerHTML=`<h2>üë§ Mon Profil</h2>`;
            const btnBack = document.createElement('button'); btnBack.className='btn'; btnBack.textContent='üè† Retour';
            btnBack.onclick= () => renderHome();
            card.appendChild(btnBack); app.appendChild(card);
        }

        function renderDemographics(track = true) {
            if(track) navigateTo('setup');
            const app = q('#app'); app.innerHTML='';
            const card = document.createElement('div'); card.className='card';
            card.innerHTML=`<h3>üìã Patient Virtuel</h3>`;
            const btnStart = document.createElement('button'); btnStart.className='btn'; btnStart.textContent='‚ñ∂Ô∏è D√©marrer';
            btnStart.onclick=()=>{ 
                state.demo = { femme: false, homme: true }; // Simplifi√© pour l'exemple
                state.answers={}; state.asked=[]; state.history=[]; state.confirmationMode = false; state.priorityQueue = [];
                askNextQuestion();
            };
            card.appendChild(btnStart); app.appendChild(card);
        }

        function prepareSigns() {
            let allSignsSet = new Set();
            PATHOLOGIES.forEach(p => { Object.keys(p.signes).forEach(s => allSignsSet.add(s)); });
            state.allSigns = Array.from(allSignsSet);
        }

        function rankPathologies() {
            const scores = PATHOLOGIES.map(p => {
                let score = 0;
                for(const signe in p.signes){
                    const ans = state.answers[signe];
                    if(ans === true) score += p.signes[signe];
                    else if(ans === false) score -= (p.signes[signe] * 0.5);
                }
                return {patho:p, score: Math.max(0, score)};
            });
            const totalScore = scores.reduce((sum, s) => sum + s.score, 0);
            state.ranked = scores.map(s => ({ ...s, prob: totalScore > 0 ? ((s.score / totalScore) * 100).toFixed(1) : 0 })).sort((a,b)=>b.prob - a.prob);
        }

        function renderCurrentQuestion() {
            const app = q('#app'); app.innerHTML='';
            const card = document.createElement('div'); card.className='card center';
            card.innerHTML=`<div class="question-text">Le patient pr√©sente-t-il :<br><strong>${formatSigneName(state.currentSign)}</strong> ?</div>`;
            const btnGroup = document.createElement('div'); btnGroup.className='button-group';
            const mkBtn = (txt, cls, val) => {
                const b = document.createElement('button'); b.className=cls; b.textContent=txt;
                b.onclick=()=>{ state.answers[state.currentSign]=val; askNextQuestion(); };
                btnGroup.appendChild(b);
            };
            mkBtn('OUI', 'btn btn-success', true); mkBtn('NON', 'btn btn-error', false);
            card.appendChild(btnGroup); app.appendChild(card);
        }

        function askNextQuestion() {
            prepareSigns();
            const remaining = state.allSigns.filter(s => !state.asked.includes(s));
            if(remaining.length === 0 || state.asked.length > 15) { showDiagnostic(); return; }
            const randomSign = remaining[Math.floor(Math.random() * remaining.length)];
            state.currentSign = randomSign; state.asked.push(randomSign);
            renderCurrentQuestion();
        }

        function showDiagnostic() {
            const app = q('#app'); app.innerHTML = '';
            rankPathologies();
            const top = state.ranked[0];
            const card = document.createElement('div'); card.className='card center';
            card.innerHTML = `<h2>üí° Diagnostic</h2><div class="diagnostic-result"><div class="diagnostic-name">${top.patho.name}</div></div>`;
            const btnHome = document.createElement('button'); btnHome.className='btn'; btnHome.textContent = 'üè† Accueil'; btnHome.onclick = () => renderHome();
            card.appendChild(btnHome); app.appendChild(card);
        }

        function renderGlossary(track = true) {
            if(track) navigateTo('glossary');
            const app = q('#app'); app.innerHTML='';
            const card = document.createElement('div'); card.className='card center'; card.innerHTML='<h2>üìö Glossaire</h2>'; 
            const btnBack = document.createElement('button'); btnBack.className='link'; btnBack.textContent='üè† Retour';
            btnBack.onclick= () => renderHome();
            const wrapper = document.createElement('div'); wrapper.className = 'glossary-wrapper';
            const content = document.createElement('div'); content.className = 'glossary-content';
            PATHOLOGIES.forEach(p => {
                const pCard = document.createElement('div'); pCard.className='patho-card';
                pCard.innerHTML=`<div class="patho-name">${p.name}</div>`;
                content.appendChild(pCard);
            });
            wrapper.appendChild(content); card.appendChild(btnBack); card.appendChild(wrapper); app.appendChild(card);
        }
    </script>
</body>
</html>

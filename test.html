<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <meta name="google-site-verification" content="8SyBOdC5YhaXDqfNYGfzP1EZbb0iQWABpkImmZHXG30" />
    
    <title>Medicome - Plateforme d'entra√Ænement sur des Cas Cliniques pour les √©tudiants en M√©decine.</title>
    
    <meta name="description" content="Entra√Ænez-vous au diagnostic m√©dical avec Medicome. Une IA interactive pour r√©viser la s√©miologie, les pathologies et r√©ussir vos examens de m√©decine (Externat, ECN, EDN).">
    
    <meta name="keywords" content="diagnostic m√©dical, cas cliniques, s√©miologie, r√©vision m√©decine, ECN, EDN, externat, intelligence artificielle sant√©, quiz m√©dical">
    
    <meta property="og:title" content="Medicome - L'IA de Diagnostic M√©dical">
    <meta property="og:description" content="Testez vos connaissances : l'IA devine la pathologie ou c'est vous qui la d√©fiez.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://medicome.fr/">
    <link rel="canonical" href="https://medicome.fr/" />
    <link rel="icon" href="favicon.png">

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        /* ================= STYLE CHROME / DARK GLOSS ================= */
        :root {
          --bg-dark: #020b16;
          --bg-light: #1e3c72;
          --glass-bg: rgba(13, 25, 48, 0.75);
          --glass-border: rgba(100, 200, 255, 0.15);
          --accent: #00d2ff;
          --accent-glow: rgba(0, 210, 255, 0.4);
          --text-main: #ffffff;
          --text-muted: #b0c4de;
          --success: #00ff9d;
          --error: #ff4d4d;
          --info: #60a5fa;
          --gold: #ffd700;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; scroll-behavior: smooth; }
        
        body {
          font-family: 'Inter', sans-serif;
          background: radial-gradient(circle at 50% 0%, var(--bg-light), var(--bg-dark) 80%);
          background-attachment: fixed;
          color: var(--text-main);
          min-height: 100vh;
          display: flex;
          flex-direction: column;
        }

        /* HEADER */
        header {
          display: flex;
          justify-content: space-between;
          padding: 10px 24px;
          background: rgba(2, 11, 22, 0.8);
          backdrop-filter: blur(15px);
          -webkit-backdrop-filter: blur(15px);
          align-items: center;
          border-bottom: 1px solid var(--glass-border);
          position: sticky; top: 0; z-index: 100;
          box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }

        .brand { display: flex; align-items: center; gap: 12px; cursor: pointer; }
        .logo-img { height: 70px; width: auto; filter: drop-shadow(0 0 8px var(--accent-glow)); transition: transform 0.3s; }
        .brand:hover .logo-img { transform: scale(1.05); }
        
        .top-right { display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
        
        /* Notification Bell */
        .notif-btn { position: relative; background: none; border: none; cursor: pointer; padding: 5px; margin-right: 10px; }
        .notif-icon { width: 24px; height: 24px; fill: var(--text-muted); transition: fill 0.3s; }
        .notif-btn:hover .notif-icon { fill: var(--accent); }
        .notif-badge { position: absolute; top: 0; right: 0; width: 10px; height: 10px; background: var(--error); border-radius: 50%; display: none; border: 1px solid var(--bg-dark); }
        
        /* Notification Dropdown/Modal */
        .notif-modal {
            position: absolute; top: 60px; right: 20px; width: 300px;
            background: var(--bg-dark); border: 1px solid var(--glass-border);
            border-radius: 12px; padding: 15px; z-index: 200;
            box-shadow: 0 10px 40px rgba(0,0,0,0.8);
            display: none; max-height: 400px; overflow-y: auto;
        }
        .notif-item { border-bottom: 1px solid rgba(255,255,255,0.1); padding: 10px 0; font-size: 13px; text-align: left; }
        .notif-item:last-child { border-bottom: none; }
        .notif-date { font-size: 11px; color: var(--accent); margin-bottom: 4px; }

        .pseudo { 
            color:var(--accent); font-weight:600; padding:6px 12px; 
            background: rgba(0, 210, 255, 0.05); 
            border: 1px solid var(--glass-border);
            border-radius:20px; cursor:pointer; font-size: 14px; 
            display: flex; align-items: center; gap: 8px;
        }

        /* BUTTONS & LINKS */
        .link {
          background: rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.1);
          color: var(--text-muted); padding:8px 16px; border-radius:8px;
          cursor:pointer; transition:all 0.3s; font-size:14px;
        }
        .link:hover { background: rgba(255,255,255,0.1); color: white; border-color: var(--accent); box-shadow: 0 0 10px var(--accent-glow); }

        /* CARDS */
        main { flex:1; max-width:1000px; width:100%; margin:0 auto; padding:30px 20px; display:flex; flex-direction:column; align-items:center; }
        
        .card { 
            background: var(--glass-bg); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            padding:32px; border-radius:20px; 
            box-shadow: 0 15px 35px rgba(0,0,0,0.6), inset 0 0 0 1px var(--glass-border); 
            margin-bottom:16px; width:100%; max-width:600px; 
            transition: transform 0.3s ease; animation: fadeIn 0.5s ease-out;
        }
        .card h2 { margin-bottom:20px; font-size:26px; text-align:center; color: white; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
        .card h3 { margin-bottom:16px; font-size:22px; text-align:center; color: var(--accent); }

        /* INPUTS */
        .input, select, textarea { 
            width:100%; padding:14px; border-radius:10px; 
            border:1px solid rgba(255,255,255,0.15); 
            background: rgba(0,0,0,0.3); color: var(--text-main); 
            margin-top:8px; margin-bottom:12px; font-size:14px; 
            transition:all 0.3s; font-family: 'Inter', sans-serif;
        }
        textarea { resize: vertical; min-height: 100px; }
        .input:focus, select:focus, textarea:focus { outline:none; border-color:var(--accent); background: rgba(0,0,0,0.5); box-shadow: 0 0 15px var(--accent-glow); }

        /* STARS RATING */
        .star-rating { display: flex; gap: 5px; justify-content: center; margin: 10px 0; direction: rtl; }
        .star-rating input { display: none; }
        .star-rating label { font-size: 25px; color: #444; cursor: pointer; transition: color 0.2s; }
        .star-rating input:checked ~ label, .star-rating label:hover, .star-rating label:hover ~ label { color: var(--gold); }

        /* ACTION BUTTONS */
        .btn { 
            background: linear-gradient(135deg, #0072ff 0%, #00c6ff 100%);
            border:none; padding:14px 24px; border-radius:12px; 
            color: #000; cursor:pointer; font-weight:700; font-size:15px; 
            transition:all 0.3s; box-shadow: 0 4px 15px rgba(0, 114, 255, 0.4);
            text-transform: uppercase; letter-spacing: 0.5px;
        }
        .btn:hover { transform:translateY(-2px); box-shadow: 0 6px 20px rgba(0, 114, 255, 0.6), inset 0 0 0 2px rgba(255,255,255,0.3); }
        .btn-success { background: linear-gradient(135deg, #00b09b 0%, #96c93d 100%); color: #022015; box-shadow: 0 4px 15px rgba(0, 176, 155, 0.4); }
        .btn-success:hover { box-shadow: 0 6px 20px rgba(0, 176, 155, 0.6); }
        .btn-error { background: linear-gradient(135deg, #cb2d3e 0%, #ef473a 100%); color: white; box-shadow: 0 4px 15px rgba(203, 45, 62, 0.4); }
        .btn-error:hover { box-shadow: 0 6px 20px rgba(203, 45, 62, 0.6); }
        .btn-code { background: transparent !important; border: 1px solid var(--accent) !important; color: var(--accent) !important; box-shadow: none !important; }
        .btn-code:hover { background: rgba(0, 210, 255, 0.1) !important; box-shadow: 0 0 15px var(--accent-glow) !important; }
        .btn-back { background: rgba(255, 255, 255, 0.1); color: #ccc; border: 1px solid rgba(255, 255, 255, 0.2); padding: 10px 20px; border-radius: 10px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.2s; }
        .btn-back:hover { background: rgba(255, 255, 255, 0.2); color: white; }

        /* ELEMENTS */
        .center { text-align:center; display:flex; flex-direction:column; align-items:center; }
        .button-group { display:flex; gap:16px; justify-content:center; flex-wrap:wrap; margin-top:12px; width: 100%; }
        .small { opacity:0.6; font-size:13px; color:var(--text-muted); margin-top:12px; text-align:center; }
        
        .question-text { 
            font-size:22px; text-align:center; line-height:1.6; padding:24px; 
            background: linear-gradient(90deg, rgba(0,210,255,0.05) 0%, rgba(0,210,255,0) 100%);
            border-radius:12px; border-left:4px solid var(--accent); 
            word-break:break-word; width: 100%; margin-bottom: 20px;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.2);
        }

        /* REVIEWS SECTION */
        .reviews-container { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; width: 100%; }
        .review-card { background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 15px; text-align: left; }
        .review-header { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
        .review-avatar { width: 30px; height: 30px; background: var(--accent); border-radius: 50%; display:flex; align-items:center; justify-content:center; font-weight:bold; color:black; font-size:12px;}
        .review-name { font-weight: 600; font-size: 14px; color: white; }
        .review-stars { color: #FFD700; font-size: 12px; }
        .review-text { font-size: 13px; color: var(--text-muted); font-style: italic; }

        /* GLOSSAIRE */
        .glossary-wrapper { display: flex; align-items: flex-start; gap: 20px; width: 100%; max-width: 1000px; position: relative; }
        .alphabet-sidebar { position: sticky; top: 100px; display: flex; flex-direction: column; gap: 2px; background: rgba(0, 0, 0, 0.4); padding: 10px; border-radius: 20px; border: 1px solid var(--glass-border); max-height: 80vh; overflow-y: auto; flex-shrink: 0; }
        .alpha-link { color: var(--text-muted); text-decoration: none; font-size: 12px; font-weight: 700; padding: 2px 8px; border-radius: 4px; transition: all 0.2s; text-align: center; }
        .alpha-link:hover { color: white; background: rgba(255,255,255,0.1); }
        .alpha-link.active { color: var(--accent); background: rgba(0, 210, 255, 0.1); }
        .alpha-link.disabled { opacity: 0.2; cursor: default; pointer-events: none; }
        .glossary-content { flex: 1; width: 100%; }
        .search-container { width: 100%; max-width: 1000px; margin-bottom: 20px; }
        .search-input { width: 100%; padding: 16px; border-radius: 12px; border: 1px solid var(--glass-border); background: rgba(0,0,0,0.4); color: white; font-size: 16px; backdrop-filter: blur(5px); }
        .search-input:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 15px var(--accent-glow); }
        .letter-header { font-size: 28px; font-weight: 800; color: var(--accent); border-bottom: 2px solid rgba(255,255,255,0.1); margin-top: 40px; margin-bottom: 20px; padding-bottom: 5px; scroll-margin-top: 110px; }
        .letter-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; }
        .patho-card { background: rgba(255, 255, 255, 0.03); padding:24px; border-radius:16px; border:1px solid rgba(255,255,255,0.05); transition:all 0.3s; cursor:pointer; }
        .patho-card:hover { transform:translateY(-5px); border-color:var(--accent); background: rgba(0, 210, 255, 0.05); box-shadow: 0 10px 30px rgba(0,0,0,0.5), 0 0 20px var(--accent-glow); }
        .patho-name { font-size:18px; font-weight:700; color:var(--accent); margin-bottom:8px; }
        .patho-desc { font-size:14px; color:rgba(255,255,255,0.7); line-height:1.5; }

        /* MASTERY PROFILE GRID */
        .mastery-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 12px; width: 100%; margin-top: 20px; }
        .mastery-item { background: rgba(0,0,0,0.2); border-radius: 10px; padding: 15px; text-align: center; border: 1px solid rgba(255,255,255,0.05); transition: all 0.3s; display: flex; flex-direction: column; align-items: center; gap: 8px; }
        .mastery-item.locked { opacity: 0.5; filter: grayscale(1); border-style: dashed; }
        .mastery-item.unlocked { border: 1px solid var(--success); background: rgba(0, 255, 157, 0.05); }
        .mastery-item.master { border: 1px solid var(--gold); background: rgba(255, 215, 0, 0.1); box-shadow: 0 0 15px rgba(255, 215, 0, 0.2); }
        .mastery-icon { font-size: 24px; }
        .mastery-name { font-size: 13px; font-weight: 600; color: white; }
        .mastery-count { font-size: 11px; color: var(--text-muted); }

        /* ALERTS & STATS */
        .alert { padding:14px; border-radius:10px; margin:12px 0; font-size:14px; width: 100%; text-align: center; font-weight: 500;}
        .alert-success { background: rgba(0, 255, 157, 0.1); border:1px solid var(--success); color:var(--success); box-shadow: 0 0 15px rgba(0, 255, 157, 0.2); }
        .alert-error { background: rgba(255, 77, 77, 0.1); border:1px solid var(--error); color:var(--error); box-shadow: 0 0 15px rgba(255, 77, 77, 0.2); }
        .stat-box { background: rgba(0,0,0,0.3); padding:20px; border-radius:12px; margin:10px 0; border: 1px solid rgba(255,255,255,0.05); text-align:center; }
        .stat-number { font-size:36px; font-weight:700; color:white; text-shadow: 0 0 10px rgba(255,255,255,0.3); }
        .diagnostic-result { background: rgba(0, 210, 255, 0.1); padding:30px; border-radius:20px; margin:20px 0; border:2px solid var(--accent); text-align:center; box-shadow: 0 0 30px var(--accent-glow); }
        .diagnostic-name { font-size:32px; font-weight:700; color:white; margin-bottom:12px; text-shadow: 0 0 10px var(--accent); }
        .score-badge { display:inline-block; background: var(--accent); color: #000; font-weight: 700; padding:6px 14px; border-radius:20px; font-size:14px; margin-top:12px; }
        .result-item { padding:12px 16px; border-radius:10px; margin-bottom:8px; background: rgba(0,0,0,0.3); display:flex; justify-content:space-between; align-items:center; border: 1px solid rgba(255,255,255,0.05); }
        .result-correct { border-left:4px solid var(--success); }
        .result-missing { border-left:4px solid #f59e0b; }
        .result-error { border-left:4px solid var(--error); }
        .result-neutral { border-left:4px solid var(--info); background: rgba(96, 165, 250, 0.1); }
        
        @keyframes spin { 100% { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }

        /* LEGAL MODAL */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 1000; display: none;
            justify-content: center; align-items: center; padding: 20px;
        }
        .modal-content {
            background: var(--bg-dark); padding: 30px; border-radius: 20px;
            max-width: 600px; width: 100%; max-height: 80vh; overflow-y: auto;
            border: 1px solid var(--glass-border); text-align: left;
        }
        .modal-content h3 { color: var(--accent); margin-top: 20px; margin-bottom: 10px; }
        .modal-content p { font-size: 14px; line-height: 1.6; color: var(--text-muted); margin-bottom: 10px; }

        /* FOOTER & SOCIALS */
        footer { text-align:center; padding:30px 20px; background: rgba(0,0,0,0.5); font-size:13px; border-top: 1px solid rgba(255,255,255,0.05); display: flex; flex-direction: column; align-items: center; gap: 15px; }
        .social-links { display: flex; gap: 20px; margin-bottom: 10px; }
        .social-link { display: flex; align-items: center; justify-content: center; width: 40px; height: 40px; background: rgba(255,255,255,0.05); border-radius: 50%; transition: all 0.3s; text-decoration: none; }
        .social-link:hover { background: rgba(0, 210, 255, 0.1); transform: scale(1.1); box-shadow: 0 0 15px var(--accent-glow); }
        .social-icon { width: 20px; height: 20px; fill: var(--text-muted); transition: fill 0.3s; }
        .social-link:hover .social-icon { fill: var(--accent); }
        .footer-nav { display: flex; gap: 20px; flex-wrap: wrap; justify-content: center;}
        .footer-link { color: var(--text-muted); text-decoration: none; font-weight: 500; transition: color 0.2s; cursor: pointer;}
        .footer-link:hover { color: var(--accent); text-decoration: underline; }

        @media (max-width:600px){
            .button-group{flex-direction:column;width:100%;}
            .btn,.link{width:100%;}
            .glossary-wrapper { flex-direction: column; }
            .alphabet-sidebar { flex-direction: row; flex-wrap: wrap; width: 100%; position: static; justify-content: center; margin-bottom: 20px; max-height: none; }
            .alpha-link { padding: 5px 10px; font-size: 14px; }
            .reviews-container { grid-template-columns: 1fr; }
            .mastery-grid { grid-template-columns: repeat(3, 1fr); }
        }
    </style>
</head>
<body>

    <header>
        <div class="brand" id="brandLogo">
            <img src="logo.png" alt="Medicome Logo - Simulateur Diagnostic M√©dical" class="logo-img">
            <h1 class="sr-only">Medicome : Entra√Ænement au Diagnostic M√©dical et S√©miologie</h1>
        </div>
        
        <div class="top-right">
            <button class="notif-btn" id="notifBtn" title="Nouveaut√©s">
                <svg class="notif-icon" viewBox="0 0 24 24"><path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.64 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2zm-2 1H8v-6c0-2.48 1.51-4.5 4-4.5s4 2.02 4 4.5v6z"/></svg>
                <div class="notif-badge" id="notifBadge"></div>
            </button>
            <div class="notif-modal" id="notifModal">
                <h4 style="color:white; border-bottom:1px solid #333; padding-bottom:10px; margin-bottom:10px;">üîî Nouveaut√©s & Mises √† jour</h4>
                <div id="notifContent">
                    <div class="small">Chargement...</div>
                </div>
            </div>

            <button id="homeBtn" class="link" style="display:none;">Accueil</button>
            <div id="pseudoBox" class="pseudo" style="display:none;">Utilisateur</div>
            <button id="logoutBtn" class="link" style="display:none;">D√©connexion</button>
        </div>
    </header>

    <main id="app">
        <div class="center" id="landing-content" style="padding: 20px; text-align: center;">
            <div style="font-size: 50px; margin-bottom: 20px;">ü©∫</div>
            <h1 style="font-size: 2rem; margin-bottom: 10px; color: white;">Medicome</h1>
            <h2 style="font-size: 1.2rem; color: var(--accent); margin-bottom: 20px; font-weight: normal;">
                Application de R√©vision M√©dicale pour Externes
            </h2>
            <div style="max-width: 600px; margin: 0 auto; color: var(--text-muted); line-height: 1.5;">
                <p>Bienvenue sur Medicome, le simulateur de cas cliniques interactif.</p>
                <p>Pr√©parez vos ECN, EDN et examens de m√©decine gr√¢ce √† notre intelligence artificielle qui vous challenge sur la s√©miologie, le diagnostic diff√©rentiel et les pathologies.</p>
            </div>
            
            <div style="margin-top: 40px;">
                <div style="font-size: 30px; animation: spin 1s infinite linear;">‚öôÔ∏è</div>
                <div class="small" style="margin-top: 10px;">Chargement du noyau m√©dical...</div>
            </div>
        </div>
    </main>

    <div class="modal-overlay" id="legalModal">
        <div class="modal-content">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h2 style="color:white;">Mentions L√©gales</h2>
                <button onclick="document.getElementById('legalModal').style.display='none'" class="link">Fermer</button>
            </div>
            <div id="legalTextContent">
                </div>
        </div>
    </div>

    <footer>
        <div class="social-links">
            <a href="https://instagram.com/medicome.fr" target="_blank" class="social-link" title="Instagram">
                <svg class="social-icon" viewBox="0 0 24 24"><path d="M7.8,2H16.2C19.4,2 22,4.6 22,7.8V16.2A5.8,5.8 0 0,1 16.2,22H7.8C4.6,22 2,19.4 2,16.2V7.8A5.8,5.8 0 0,1 7.8,2M7.6,4A3.6,3.6 0 0,0 4,7.6V16.4C4,18.39 5.61,20 7.6,20H16.4A3.6,3.6 0 0,0 20,16.4V7.6C20,5.61 18.39,4 16.4,4H7.6M17.25,5.5A1.25,1.25 0 0,1 18.5,6.75A1.25,1.25 0 0,1 17.25,8A1.25,1.25 0 0,1 16,6.75A1.25,1.25 0 0,1 17.25,5.5M12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9Z" /></svg>
            </a>
            <a href="https://www.tiktok.com/@medicome.fr" target="_blank" class="social-link" title="TikTok">
                <svg class="social-icon" viewBox="0 0 24 24"><path d="M12.5 3.5v10.55c0 1.9-1.55 3.45-3.45 3.45S5.6 15.95 5.6 14.05c0-1.9 1.55-3.45 3.45-3.45 0.3 0 0.6 0.05 0.85 0.15V7.4c-0.25-0.1-0.55-0.15-0.85-0.15-3.8 0-6.9 3.1-6.9 6.9s3.1 6.9 6.9 6.9c3.8 0 6.9-3.1 6.9-6.9V7.6c1.7 1.2 3.8 1.9 6.05 1.9v-3.75c-2.15 0-4.05-0.9-5.3-2.3H12.5z"/></svg>
            </a>
            <a href="https://x.com/medicome_fr" target="_blank" class="social-link" title="X (Twitter)">
                <svg class="social-icon" viewBox="0 0 24 24"><path d="M22.46,6C21.69,6.35 20.86,6.58 20,6.69C20.88,6.16 21.56,5.32 21.88,4.31C21.05,4.81 20.13,5.16 19.16,5.36C18.37,4.5 17.26,4 16,4C13.65,4 11.73,5.92 11.73,8.29C11.73,8.63 11.77,8.96 11.84,9.27C8.28,9.09 5.11,7.38 3,4.79C2.63,5.42 2.42,6.16 2.42,6.94C2.42,8.43 3.17,9.75 4.33,10.5C3.62,10.5 2.96,10.3 2.38,10C2.38,10 2.38,10.03 2.38,10.05C2.38,12.11 3.86,13.85 5.82,14.24C5.46,14.34 5.08,14.39 4.69,14.39C4.42,14.39 4.15,14.36 3.89,14.31C4.43,16 6,17.26 7.89,17.29C6.43,18.45 4.58,19.13 2.56,19.13C2.22,19.13 1.88,19.11 1.54,19.07C3.44,20.29 5.7,21 8.12,21C16,21 20.33,14.46 20.33,8.79C20.33,8.6 20.33,8.42 20.32,8.23C21.16,7.63 21.88,6.87 22.46,6Z" /></svg>
            </a>
        </div>
        <div class="footer-nav">
            <span class="footer-link" onclick="window.scrollTo(0,0)">Haut de page</span>
            <span class="footer-link" id="reviewsLink">Avis Utilisateurs</span>
            <span class="footer-link" id="contactLink">Nous Contacter</span>
            <span class="footer-link" onclick="renderLegal()">Mentions L√©gales & Confidentialit√©</span>
        </div>
        <div style="margin-top:10px; opacity:0.6;">Medicome ¬© 2025 - Outil p√©dagogique</div>
    </footer>

    <script type="module">
        if (window.location.hostname.includes("github.io")) {
            window.location.href = "https://medicome.fr";
        }

        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, updateProfile, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, getDocs, setDoc, addDoc, collection, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // --- LOGIQUE D'ENTONNOIR (Raffinement) ---
        const REFINEMENTS = {
            "douleur_abdominale": ["douleur_fosse_iliaque_droite", "douleur_hypocondre_droit", "douleur_fosse_iliaque_gauche", "douleur_epigastrique", "douleur_transfixiante_dos", "douleur_bas_ventre", "douleur_pelvienne", "douleur_abdominale_diffuse", "crampes_abdominales", "douleur_abdominale_intermittente", "douleur_sus_pubienne", "troubles_transit"],
            "douleur_thoracique": ["douleur_thoracique_oppressive", "douleur_thoracique_dechirante", "douleur_thoracique_cot√©", "douleur_basithoracique", "douleur_inspiration", "douleur_thoracique_point_cote"],
            "douleur_dos": ["douleur_lombaire_brutale", "douleur_lombaire_unilaterale", "douleur_lombaire", "douleur_bas_dos", "douleur_bas_dos_nuit", "douleur_dos_os", "douleur_dos_brutale"],
            "douleur_membre_traumatisme": ["impossibilite_marcher", "douleur_poignet", "chute_recente", "jambe_froide_pale", "douleur_articulaire_intense", "douleur_gros_orteil", "douleur_jambe_brutale_intense", "douleur_aine_hanche", "douleur_mains", "douleur_talon", "fourmillements_doigts"],
            "dyspnee": ["dyspnee_effort", "orthopnee_dyspnee_couchee", "dyspnee_brutale", "dyspnee_sifflante", "essoufflement_aggrave", "gene_respiratoire"],
            "toux": ["toux_seche", "toux_grasse", "toux_sanglante", "chant_du_coq", "toux_chronique", "toux_nuit"],
            "troubles_visuels": ["vision_floue", "vision_double", "baisse_vision_brutale", "amputation_champ_visuel", "eclairs_lumineux", "mouches_devant_yeux", "vision_centrale_floue", "vision_double_un_oeil", "trouble_vision_flou"],
            "troubles_neuro": ["paralysie_unilaterale", "troubles_parole_aphasie", "asymetrie_visage", "perte_sensibilite", "perte_equilibre", "tremblement_repos", "lenteur_mouvements", "machoire_bloquee", "corps_raide_contracte", "paralysie_descend_tete_vers_pieds", "paralysie_monte_pieds_vers_tete", "perte_connaissance"],
            "cephalees": ["cephalees_intenses", "cephalees_explosives_brutales", "mal_tete_unilateral"],
            "anomalie_peau": ["plaques_rouges", "vesicules_bulles", "demangeaisons", "grain_beaute_suspect", "tache_noire", "jambe_rouge", "purpura", "taches_rouges_jambes", "taches_rouges_peau", "tache_rouge_s_etend_peau", "plaques_rouges_croutes", "perle_translucide_peau", "croute_ne_guerit_pas", "boutons_bulles_corps", "taches_peau_purpura", "eruption_boutons_corps", "eruption_corps", "peau_aspect_granite", "boule_aine_douloureuse_dure"],
            "trouble_psy": ["tristesse_permanente", "delire_paranoiaque", "hallucinations", "perte_memoire", "agitation", "excitation_euphorie", "maigreur_extreme", "ne_se_lave_plus", "oubli_faits_recents", "cherches_ses_mots"],
            "genes_urinaires": ["sang_urines", "brulures_urinaires", "impossibilite_uriner", "regles_tres_abondantes", "douleur_testicule_brutale", "pertes_vaginales_anormales", "sang_urines_rouge", "difficulte_uriner", "urines_abondantes", "urines_mousseuses"]
        };

        // ================= AUDIO SYSTEM (Synth) =================
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(type) {
            if(audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            if (type === 'success') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(523.25, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(1046.5, audioCtx.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.4);
            } else if (type === 'error') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.3);
            }
        }

        const firebaseConfig = {
            apiKey: "AIzaSyCig9G4gYHU5h642YV1IZxthYm_IXp6vZU",
            authDomain: "medicome-paco.firebaseapp.com",
            projectId: "medicome-paco",
            storageBucket: "medicome-paco.firebasestorage.app",
            messagingSenderId: "332171806096",
            appId: "1:332171806096:web:36889325196a7a718b5f15",
            measurementId: "G-81HJ9DWBMX"
        };

        let app, auth, db;
        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
        } catch (error) {
            console.error("Erreur Firebase:", error);
            document.querySelector('#app').innerHTML = `<div class="alert alert-error">Erreur de configuration : ${error.message}</div>`;
        }

        let PATHOLOGIES = [];
        const ACCESS_CODES = [ { code: "SuperCode1", pseudo:"Admin" } ];

        let state = {
            currentUser: null, pseudo: null, 
            progression: { correct: 0, incorrect: 0, streak: 0, mastery: {} },
            isGuest: false, demo:{}, currentSign:null, answers:{}, asked:[], allSigns:[], ranked: [], diagnosticShown:false, previousDiagnostics:[],
            history: [],
            confirmationMode: false, confirmationQueue: [], confirmedPatho: null,
            priorityQueue: []
        };

        async function initApp() {
            try {
                const response = await fetch('./pathologies.json');
                if (!response.ok) throw new Error("Impossible de lire le fichier de donn√©es");
                PATHOLOGIES = await response.json();
                
                // DEEP LINKING
                const urlParams = new URLSearchParams(window.location.search);
                const ficheDemandee = urlParams.get('fiche');
                if (ficheDemandee) {
                    const pathoTrouvee = PATHOLOGIES.find(p => p.name.toLowerCase() === ficheDemandee.toLowerCase());
                    if (pathoTrouvee) {
                        q('#app').innerHTML = ''; // Clear loading
                        // Mock result for display
                        showDiagnosticDetails({patho: pathoTrouvee});
                        return; // Stop further init
                    }
                }

                startAuthListener();
                fetchNotifications();
                
                // Bind links
                const cLink = document.getElementById('contactLink');
                if(cLink) cLink.onclick = renderContact;
                
                const rLink = document.getElementById('reviewsLink');
                if(rLink) rLink.onclick = renderReviews;

                // NOTIFICATION LOGIC
                const notifBtn = q('#notifBtn');
                const notifModal = q('#notifModal');
                if(notifBtn) {
                    notifBtn.onclick = (e) => {
                        e.stopPropagation();
                        const isVisible = notifModal.style.display === 'block';
                        notifModal.style.display = isVisible ? 'none' : 'block';
                        if(!isVisible) {
                            const badge = q('#notifBadge');
                            if(badge) badge.style.display = 'none';
                        }
                    };
                }
                window.onclick = () => { if(notifModal) notifModal.style.display = 'none'; };

                // LOGO LOGIC
                const brandLogo = document.getElementById('brandLogo');
                if(brandLogo) {
                    brandLogo.onclick = () => {
                        if (state.currentUser || state.isGuest) { renderHome(); } 
                    };
                }
                
                // Global legal render
                window.renderLegal = renderLegal;

            } catch (err) {
                console.error(err);
                document.querySelector('#app').innerHTML = `
                    <div class="card center">
                        <h2 style="color:var(--error)">Erreur de chargement</h2>
                        <p>Impossible de charger 'pathologies.json'.</p>
                        <div class="small" style="color:orange">${err.message}</div>
                    </div>
                `;
            }
        }
        initApp();

        async function fetchNotifications() {
            try {
                const qRef = query(collection(db, "notifications"), orderBy("date", "desc"), limit(5));
                const snapshot = await getDocs(qRef);
                const container = q('#notifContent');
                
                if (snapshot.empty) {
                    container.innerHTML = '<div class="small">Aucune nouveaut√© pour le moment.</div>';
                    return;
                }
                
                container.innerHTML = '';
                snapshot.forEach(doc => {
                    const n = doc.data();
                    const div = document.createElement('div');
                    div.className = 'notif-item';
                    const dateStr = n.date && n.date.seconds ? new Date(n.date.seconds * 1000).toLocaleDateString() : 'R√©cemment';
                    div.innerHTML = `<div class="notif-date">${dateStr}</div><div style="color:white;">${n.message}</div>`;
                    container.appendChild(div);
                });
                
                const badge = q('#notifBadge');
                if(badge) badge.style.display = 'block';
                
            } catch (e) {
                console.log("Erreur notifs:", e);
                const container = q('#notifContent');
                if(container) container.innerHTML = '<div class="small">Impossible de charger les actus.</div>';
            }
        }

        function startAuthListener() {
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    state.currentUser = user; state.isGuest = false;
                    let displayPseudo = user.displayName;
                    if (!displayPseudo && user.email) displayPseudo = user.email.split('@')[0];
                    state.pseudo = displayPseudo; updateHeader(); 
                    const docRef = doc(db, "users", user.uid);
                    try {
                        const docSnap = await getDoc(docRef);
                        if (docSnap.exists()) {
                            const data = docSnap.data();
                            if (data.pseudo) state.pseudo = data.pseudo;
                            state.progression = data.progression || { correct: 0, incorrect: 0, streak: 0, mastery: {} };
                        } else { saveProgression(); }
                        updateHeader(); renderHome();
                    } catch(e) { renderHome(); }
                } else {
                    const savedGuest = localStorage.getItem('medicome_guest_progression');
                    const savedPseudo = localStorage.getItem('medicome_guest_pseudo');
                    if(!state.isGuest && savedGuest && savedPseudo) {
                        state.isGuest = true; state.pseudo = savedPseudo;
                        state.progression = JSON.parse(savedGuest);
                        if(state.progression.streak === undefined) state.progression.streak = 0;
                        if(!state.progression.mastery) state.progression.mastery = {};
                        updateHeader(); renderHome();
                        setTimeout(() => showAlert(`Bon retour, ${state.pseudo} !`, 'success'), 500);
                    } else {
                        state.currentUser = null; state.pseudo = null; state.progression = { correct: 0, incorrect: 0, streak: 0, mastery: {} };
                        renderLogin(); updateHeader();
                    }
                }
            });
        }

        function q(sel){ return document.querySelector(sel); }
        function formatSigneName(sign){ return sign.replace(/_/g,' ').replace(/\b\w/g,c=>c.toUpperCase()); }
        function showAlert(message,type){
            const alertDiv = document.createElement('div');
            alertDiv.className = 'alert alert-' + type;
            alertDiv.textContent = message;
            const app = q('#app');
            if(app){ app.insertBefore(alertDiv,app.firstChild); setTimeout(()=>{ if(alertDiv.parentNode) alertDiv.parentNode.removeChild(alertDiv); },3000); }
        }
        
        function triggerConfetti() {
            if(window.confetti) {
                window.confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
            }
        }

        async function saveProgression() {
            if (!state.isGuest && state.currentUser) {
                try {
                    const userRef = doc(db, "users", state.currentUser.uid);
                    await setDoc(userRef, { progression: state.progression, pseudo: state.pseudo, lastUpdate: new Date() }, { merge: true });
                } catch (e) { console.error("Erreur sauvegarde Cloud", e); }
            } else if (state.isGuest) {
                localStorage.setItem('medicome_guest_progression', JSON.stringify(state.progression));
                localStorage.setItem('medicome_guest_pseudo', state.pseudo);
            }
        }

        function updateHeader(){
            const pseudoBox = q("#pseudoBox"); const homeBtn = q("#homeBtn"); const logoutBtn = q("#logoutBtn");
            const currentStreak = state.progression.streak || 0;
            const streakDisplay = currentStreak > 0 ? ` <span style="color:#ff9f43; margin-left:8px;">üî• ${currentStreak}</span>` : '';

            if(state.pseudo){ 
                pseudoBox.innerHTML = state.pseudo + (state.isGuest ? " (Local)" : "") + streakDisplay; 
                pseudoBox.style.display='inline-block'; pseudoBox.onclick=renderProfile;
                homeBtn.style.display='inline-block'; logoutBtn.style.display='inline-block';
            } else { 
                pseudoBox.style.display='none'; homeBtn.style.display='none'; logoutBtn.style.display='none';
            }
            homeBtn.onclick=renderHome;
            logoutBtn.onclick = () => {
                localStorage.removeItem('medicome_guest_progression'); localStorage.removeItem('medicome_guest_pseudo');
                state.isGuest = false; state.pseudo = null; state.currentUser = null; state.progression = { correct: 0, incorrect: 0, streak: 0, mastery:{} }; 
                signOut(auth).then(() => { renderLogin(); updateHeader(); showAlert("D√©connect√©", "success"); }).catch(() => { renderLogin(); updateHeader(); });
            };
        }

        function renderLogin() {
            const app = q('#app'); app.innerHTML='';
            const card = document.createElement('div'); card.className='card center'; card.innerHTML='<h2>‚òÅÔ∏è Connexion Cloud</h2>';
            const inputUser = document.createElement('input'); inputUser.placeholder='Email'; inputUser.className='input';
            const inputPass = document.createElement('input'); inputPass.placeholder='Mot de passe'; inputPass.className='input'; inputPass.type='password';
            
            const btnLogin = document.createElement('button'); btnLogin.className='btn'; btnLogin.textContent='Se connecter';
            btnLogin.onclick = async () => {
                try { await signInWithEmailAndPassword(auth, inputUser.value, inputPass.value); showAlert("Connexion r√©ussie !", "success"); } catch (error) { showAlert("Erreur: " + error.message, "error"); }
            };
            
            const btnForgot = document.createElement('div'); 
            btnForgot.className='small link'; btnForgot.style.border='none'; btnForgot.textContent='Mot de passe oubli√© ?';
            btnForgot.onclick = async () => {
                if(!inputUser.value) return showAlert("Veuillez entrer votre email d'abord", "error");
                try { await sendPasswordResetEmail(auth, inputUser.value); showAlert("Email de r√©initialisation envoy√© !", "success"); } catch(e) { showAlert("Erreur: " + e.message, "error"); }
            };

            card.appendChild(inputUser); card.appendChild(inputPass); card.appendChild(btnLogin); card.appendChild(btnForgot);
            
            const sep = document.createElement('div'); sep.textContent='‚Äî Pas encore de compte ? ‚Äî'; sep.className='small'; sep.style.margin='16px 0'; card.appendChild(sep);
            const inRegEmail = document.createElement('input'); inRegEmail.placeholder='Nouvel Email'; inRegEmail.className='input';
            const inRegPass = document.createElement('input'); inRegPass.placeholder='Nouveau Mot de passe'; inRegPass.className='input'; inRegPass.type='password';
            const inPseudo = document.createElement('input'); inPseudo.placeholder='Votre Pseudo'; inPseudo.className='input';
            const btnReg = document.createElement('button'); btnReg.className='link'; btnReg.textContent='Cr√©er un compte Cloud';
            btnReg.onclick = async () => {
                if(!inRegEmail.value || !inRegPass.value || !inPseudo.value) return showAlert('Remplissez tout','error');
                try {
                    const userCredential = await createUserWithEmailAndPassword(auth, inRegEmail.value, inRegPass.value);
                    const user = userCredential.user; await updateProfile(user, { displayName: inPseudo.value });
                    await setDoc(doc(db, "users", user.uid), { pseudo: inPseudo.value, email: inRegEmail.value, progression: { correct: 0, incorrect: 0, streak: 0, mastery: {} }, createdAt: new Date() }, { merge: true });
                    state.pseudo = inPseudo.value; showAlert("Compte cr√©√© !", "success"); updateHeader(); renderHome();
                } catch (error) { showAlert("Erreur cr√©ation: " + error.message, "error"); }
            };
            card.appendChild(inRegEmail); card.appendChild(inRegPass); card.appendChild(inPseudo); card.appendChild(btnReg);
            const sepCode = document.createElement('div'); sepCode.textContent='‚Äî ou Acc√®s Rapide (Local) ‚Äî'; sepCode.className='small'; sepCode.style.margin='16px 0'; card.appendChild(sepCode);
            const inputCode = document.createElement('input'); inputCode.placeholder='Cl√© d\'acc√®s'; inputCode.className='input';
            const btnCode = document.createElement('button'); btnCode.className='btn btn-code'; btnCode.textContent='Utiliser une cl√©';
            btnCode.onclick = () => {
                const codeFound = ACCESS_CODES.find(ac => ac.code === inputCode.value);
                if(codeFound) {
                    state.isGuest = true; state.pseudo = codeFound.pseudo; state.progression = {correct:0, incorrect:0, streak:0, mastery:{}};
                    saveProgression(); updateHeader(); renderHome(); showAlert(`Mode Invit√©: ${codeFound.pseudo}`, 'success');
                } else { showAlert('Cl√© invalide', 'error'); }
            };
            card.appendChild(inputCode); card.appendChild(btnCode); app.appendChild(card);
        }

        function renderHome() {
            const app = q('#app'); app.innerHTML='';
            const prog = state.progression;
            const card = document.createElement('div'); card.className='card center';
            let cloudBadge = state.isGuest ? '<span style="color:orange; font-size:0.8em; margin-bottom:10px">üíæ Mode Local (Navigateur)</span>' : '<span style="color:var(--success); font-size:0.8em; margin-bottom:10px">‚òÅÔ∏è Sauvegarde Cloud Active</span>';
            const displayName = state.pseudo || '...';
            
            const tutorialHTML = `
                <div style="background: rgba(0, 210, 255, 0.05); border: 1px solid var(--accent); border-radius: 12px; padding: 20px; margin: 20px 0; text-align: left; width: 100%;">
                    <h3 style="color:var(--accent); font-size: 1.1em; margin-bottom: 10px;">üéì Mode d'emploi : D√©fie l'Algorithme</h3>
                    <p style="font-size: 0.95em; line-height: 1.5; color: #e0e7ff;">
                        Ici, c'est le monde √† l'envers : <strong>C'est toi qui connais le diagnostic, et l'IA qui doit le deviner.</strong>
                    </p>
                    <ul style="margin-top: 10px; margin-left: 20px; font-size: 0.9em; color: var(--text-muted);">
                        <li style="margin-bottom:5px;">üß† <strong>√âtape 1 :</strong> Choisis une pathologie dans ta t√™te (ex: Appendicite).</li>
                        <li style="margin-bottom:5px;">ü©∫ <strong>√âtape 2 :</strong> L'IA va te poser des questions sur les signes cliniques.</li>
                        <li>‚úÖ <strong>√âtape 3 :</strong> R√©ponds correctement (OUI/NON) pour guider l'IA vers ta pathologie.</li>
                    </ul>
                    <p style="margin-top: 10px; font-size: 0.85em; font-style: italic; color: var(--accent);">
                        Si l'IA se trompe, c'est peut-√™tre que tu as oubli√© un signe clinique important !
                    </p>
                </div>
            `;

            card.innerHTML = `<h2>üëã Bonjour ${displayName}</h2>${cloudBadge}
                            ${tutorialHTML}
                            <div class="stat-box" style="width:100%"><div class="stat-number">${prog.correct + prog.incorrect}</div><div class="stat-label">Cas jou√©s</div></div>
                            <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;width:100%;margin-top:12px;">
                            <div class="stat-box" style="text-align:center; background:rgba(0, 255, 157, 0.1); border-color:var(--success)"><div class="stat-number" style="color:var(--success);">${prog.correct}</div><div class="stat-label">IA a trouv√©</div></div>
                            <div class="stat-box" style="text-align:center; background:rgba(255, 77, 77, 0.1); border-color:var(--error)"><div class="stat-number" style="color:var(--error);">${prog.incorrect}</div><div class="stat-label">√âchecs</div></div>
                            </div>`;
            
            const btnDiag = document.createElement('button'); btnDiag.className='btn'; btnDiag.textContent='ü©∫ Lancer le d√©fi'; btnDiag.style.marginTop='24px'; btnDiag.style.width='100%'; 
            btnDiag.onclick= () => {
                if(audioCtx.state === 'suspended') audioCtx.resume();
                renderDemographics();
            };
            const btnGloss = document.createElement('button'); btnGloss.className='link'; btnGloss.textContent='üìö Glossaire des pathologies'; btnGloss.style.marginTop='12px'; btnGloss.onclick=renderGlossary;
            const btnProf = document.createElement('button'); btnProf.className='link'; btnProf.textContent='üë§ Mon Profil'; btnProf.style.marginTop='6px'; btnProf.onclick=renderProfile;
            
            card.appendChild(btnDiag); card.appendChild(btnGloss); card.appendChild(btnProf); 
            app.appendChild(card);
        }

        // --- NEW REVIEWS SYSTEM ---
        async function renderReviews() {
            const app = q('#app'); app.innerHTML='';
            const card = document.createElement('div'); card.className='card center';
            card.innerHTML = `<h2>‚≠ê Avis Utilisateurs</h2><p class="small" style="margin-bottom:20px">Ce qu'ils pensent de Medicome.</p>`;

            // --- FORMULAIRE D'AJOUT ---
            const formDiv = document.createElement('div');
            formDiv.style.background = 'rgba(255,255,255,0.05)'; formDiv.style.padding='15px'; formDiv.style.borderRadius='10px'; formDiv.style.width='100%'; formDiv.style.marginBottom='20px';
            
            formDiv.innerHTML = `<h4 style="margin-bottom:10px; color:var(--accent);">Laisser un avis</h4>
            <div class="star-rating">
                <input type="radio" id="5-stars" name="rating" value="5" /><label for="5-stars">‚òÖ</label>
                <input type="radio" id="4-stars" name="rating" value="4" /><label for="4-stars">‚òÖ</label>
                <input type="radio" id="3-stars" name="rating" value="3" /><label for="3-stars">‚òÖ</label>
                <input type="radio" id="2-stars" name="rating" value="2" /><label for="2-stars">‚òÖ</label>
                <input type="radio" id="1-star" name="rating" value="1" /><label for="1-star">‚òÖ</label>
            </div>
            <textarea id="reviewText" class="input" placeholder="Votre commentaire..." style="min-height:60px;"></textarea>
            <button id="submitReviewBtn" class="btn" style="width:100%; font-size:13px;">Publier l'avis</button>`;
            
            card.appendChild(formDiv);

            // --- CONTAINER AVIS ---
            const reviewsContainer = document.createElement('div');
            reviewsContainer.className = 'reviews-container';
            
            // --- AVIS STATIQUES (Originaux) ---
            reviewsContainer.innerHTML = `
                <div class="review-card">
                    <div class="review-header"><div class="review-avatar">A</div><div><div class="review-name">Antoine D.</div><div class="review-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div></div></div>
                    <div class="review-text">"Super outil pour r√©viser mes cas cliniques avant les partiels. Simple et efficace."</div>
                </div>
                <div class="review-card">
                    <div class="review-header"><div class="review-avatar">S</div><div><div class="review-name">Sarah L.</div><div class="review-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</div></div></div>
                    <div class="review-text">"L'interface est top. J'aimerais juste encore plus de pathologies !"</div>
                </div>
                <div class="review-card">
                    <div class="review-header"><div class="review-avatar">M</div><div><div class="review-name">Maxime P.</div><div class="review-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div></div></div>
                    <div class="review-text">"Indispensable pour l'externat. Le mode invit√© est super pratique."</div>
                </div>
                <div class="review-card">
                    <div class="review-header"><div class="review-avatar">L</div><div><div class="review-name">L√©a B.</div><div class="review-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div></div></div>
                    <div class="review-text">"Merci pour cet outil gratuit. √áa m'a sauv√© sur la s√©mio cardio !"</div>
                </div>
            `;

            // --- CHARGER AVIS DYNAMIQUES DEPUIS FIREBASE ---
            try {
                const qRev = query(collection(db, "reviews"), orderBy("date", "desc"), limit(10));
                const snap = await getDocs(qRev);
                snap.forEach(doc => {
                    const r = doc.data();
                    const stars = "‚òÖ".repeat(r.rating) + "‚òÜ".repeat(5-r.rating);
                    const div = document.createElement('div');
                    div.className = 'review-card';
                    div.innerHTML = `
                        <div class="review-header">
                            <div class="review-avatar">${r.pseudo.charAt(0).toUpperCase()}</div>
                            <div>
                                <div class="review-name">${r.pseudo}</div>
                                <div class="review-stars" style="color:var(--gold)">${stars}</div>
                            </div>
                        </div>
                        <div class="review-text">${r.text}</div>
                    `;
                    reviewsContainer.insertBefore(div, reviewsContainer.firstChild);
                });
            } catch(e) { console.log("Erreur chargement avis dynamiques", e); }

            card.appendChild(reviewsContainer);
            
            const btnBack = document.createElement('button'); btnBack.className='btn'; btnBack.textContent='Retour';
            btnBack.style.marginTop = '20px';
            btnBack.onclick = () => { if(state.pseudo) renderHome(); else renderLogin(); };
            card.appendChild(btnBack);

            app.appendChild(card);

            // LOGIC SUBMIT
            setTimeout(() => {
                const submitBtn = q('#submitReviewBtn');
                if(submitBtn){
                    submitBtn.onclick = async () => {
                        const text = q('#reviewText').value;
                        const ratingEl = document.querySelector('input[name="rating"]:checked');
                        if(!text || !ratingEl) return showAlert("Note et message requis", "error");
                        
                        const rating = parseInt(ratingEl.value);
                        const pseudo = state.pseudo || "Anonyme";
                        
                        try {
                            await addDoc(collection(db, "reviews"), {
                                pseudo, text, rating, date: new Date()
                            });
                            showAlert("Merci pour votre avis !", "success");
                            renderReviews(); // Reload
                        } catch(e) { showAlert("Erreur d'envoi", "error"); }
                    };
                }
            }, 100);
        }

        // --- NEW LEGAL MODAL LOGIC ---
        function renderLegal() {
            const modal = q('#legalModal');
            const content = q('#legalTextContent');
            content.innerHTML = `
                <h3>1. √âditeur du site</h3>
                <p>Le site Medicome.fr est √©dit√© √† titre personnel. <br>Contact : via le formulaire de contact du site.</p>
                
                <h3>2. H√©bergement</h3>
                <p>Le site est h√©berg√© par GitHub Pages (GitHub Inc., 88 Colin P Kelly Jr St, San Francisco, CA 94107, USA).</p>
                <p>Les donn√©es sont stock√©es sur Google Firebase (Google Ireland Limited, Gordon House, Barrow Street, Dublin 4, Irlande).</p>
                
                <h3>3. Donn√©es Personnelles (RGPD)</h3>
                <p>Medicome recueille votre adresse email uniquement pour l'authentification. Aucune donn√©e n'est revendue √† des tiers. Conform√©ment √† la loi, vous disposez d'un droit d'acc√®s, de rectification et de suppression de vos donn√©es en nous contactant.</p>
                
                <h3>4. Cookies</h3>
                <p>Nous utilisons uniquement des cookies techniques n√©cessaires au fonctionnement (session utilisateur). Aucun cookie publicitaire n'est utilis√©.</p>
            `;
            modal.style.display = 'flex';
        }

        function renderContact() {
            const app = q('#app'); app.innerHTML='';
            const card = document.createElement('div'); card.className='card center';
            
            card.innerHTML = `<h2>‚úâÔ∏è Nous Contacter</h2><p class="small" style="margin-bottom:20px">Une suggestion ? Un bug ? √âcrivez-nous.</p>`;
            
            const inputName = document.createElement('input'); inputName.className='input'; inputName.placeholder='Votre Nom';
            if(state.pseudo) inputName.value = state.pseudo;
            
            const inputEmail = document.createElement('input'); inputEmail.className='input'; inputEmail.placeholder='Votre Email';
            if(state.currentUser && state.currentUser.email) inputEmail.value = state.currentUser.email;

            const inputText = document.createElement('textarea'); inputText.className='input'; inputText.placeholder='Votre message...';
            
            const btnSend = document.createElement('button'); btnSend.className='btn'; btnSend.textContent='Envoyer le message';
            btnSend.onclick = async () => {
                if(!inputText.value || !inputEmail.value) { showAlert("Merci de remplir les champs", "error"); return; }
                btnSend.textContent = 'Envoi...';
                btnSend.disabled = true;

                try {
                    await addDoc(collection(db, "messages"), {
                        name: inputName.value,
                        email: inputEmail.value,
                        message: inputText.value,
                        date: new Date(),
                        uid: state.currentUser ? state.currentUser.uid : 'guest'
                    });
                    showAlert("Message envoy√© avec succ√®s !", "success");
                    setTimeout(() => { if(state.pseudo) renderHome(); else renderLogin(); }, 1500);
                } catch(e) {
                    console.error(e);
                    showAlert("Erreur lors de l'envoi", "error");
                    btnSend.textContent = 'Envoyer le message';
                    btnSend.disabled = false;
                }
            };

            const btnCancel = document.createElement('button'); btnCancel.className='link'; btnCancel.textContent='Annuler';
            btnCancel.onclick = () => { if(state.pseudo) renderHome(); else renderLogin(); };

            card.appendChild(inputName);
            card.appendChild(inputEmail);
            card.appendChild(inputText);
            card.appendChild(btnSend);
            card.appendChild(btnCancel);
            app.appendChild(card);
        }

        function renderProfile() {
            const app = q('#app'); app.innerHTML='';
            const prog = state.progression;
            const total = prog.correct + prog.incorrect;
            const card = document.createElement('div'); card.className='card center';
            card.style.maxWidth = '800px';

            const title = document.createElement('h2'); title.textContent=`üë§ Profil de ${state.pseudo || 'Utilisateur'}`; card.appendChild(title);
            
            // --- Stats Grid ---
            const gridDiv = document.createElement('div');
            gridDiv.style.cssText='display:grid;grid-template-columns:1fr 1fr;gap:12px;width:100%;margin-top:12px;';
            gridDiv.innerHTML=`<div class="stat-box"><div class="stat-number" style="color:var(--success);">${prog.correct}</div><div class="stat-label">‚úì Corrects</div></div>
                               <div class="stat-box"><div class="stat-number" style="color:var(--error);">${prog.incorrect}</div><div class="stat-label">‚úó Incorrects</div></div>`;
            card.appendChild(gridDiv);
            
            // Streak
            if(prog.streak > 0) {
                 const statStreak = document.createElement('div');
                statStreak.className='stat-box'; statStreak.style.width='100%';
                statStreak.style.cssText='margin-top:12px;background:rgba(255, 159, 67, 0.1);border-color:#ff9f43;';
                statStreak.innerHTML=`<div class="stat-number" style="color:#ff9f43;">üî• ${prog.streak}</div><div class="stat-label">S√©rie actuelle</div>`;
                card.appendChild(statStreak);
            }

            // --- MASTERY SECTION (COLLECTION) ---
            const masteryTitle = document.createElement('h3'); 
            masteryTitle.innerHTML = 'üèÜ Ma Collection Clinique'; 
            masteryTitle.style.marginTop = '30px';
            card.appendChild(masteryTitle);

            const masteryGrid = document.createElement('div');
            masteryGrid.className = 'mastery-grid';

            const sortedPathos = [...PATHOLOGIES].sort((a, b) => a.name.localeCompare(b.name));
            const masteryData = prog.mastery || {};

            sortedPathos.forEach(p => {
                const count = masteryData[p.name] || 0;
                const mItem = document.createElement('div');
                let statusClass = 'locked';
                let icon = 'üîí';
                
                if (count >= 3) { statusClass = 'master'; icon = 'üèÜ'; } 
                else if (count >= 1) { statusClass = 'unlocked'; icon = '‚úÖ'; }

                mItem.className = `mastery-item ${statusClass}`;
                mItem.innerHTML = `<div class="mastery-icon">${icon}</div><div class="mastery-name">${p.name}</div><div class="mastery-count">${count} r√©ussite${count > 1 ? 's' : ''}</div>`;
                masteryGrid.appendChild(mItem);
            });
            card.appendChild(masteryGrid);

            // --- Buttons ---
            const btnReset = document.createElement('button');
            btnReset.className = 'link'; btnReset.style.color = 'var(--error)'; btnReset.style.marginTop = '30px'; btnReset.style.borderColor = 'rgba(239, 68, 68, 0.3)';
            btnReset.textContent = 'üóëÔ∏è R√©initialiser Stats';
            btnReset.onclick = async () => {
                if(confirm("Voulez-vous vraiment effacer toutes vos statistiques ?")) {
                    state.progression = { correct: 0, incorrect: 0, streak: 0, mastery: {} }; await saveProgression(); updateHeader(); renderProfile(); showAlert("Statistiques remises √† z√©ro", "success");
                }
            };
            card.appendChild(btnReset);
            const btnBack = document.createElement('button'); btnBack.className='btn'; btnBack.textContent='üè† Retour';
            btnBack.style.marginTop='20px'; btnBack.onclick=renderHome;
            card.appendChild(btnBack); app.appendChild(card);
        }

        function renderDemographics() {
            const app = q('#app'); app.innerHTML='';
            const card = document.createElement('div'); card.className='card';
            card.innerHTML=`<h3>üìã Donn√©es d√©mographiques</h3><p class="small" style="margin-bottom:20px">Param√©trez le patient virtuel.</p>`;
            const createSel = (lbl, id, opts) => {
                const l = document.createElement('label'); l.textContent=lbl; l.style.color='var(--accent)';
                const s = document.createElement('select'); s.id=id; s.className='input';
                opts.forEach(o=> { const op=document.createElement('option'); op.value=o[0]; op.textContent=o[1]; s.appendChild(op); });
                card.appendChild(l); card.appendChild(s);
            };
            createSel("Sexe", "demo-sexe", [["rien","Al√©atoire / Inconnu"],["femme","Femme"],["homme","Homme"]]);
            createSel("Plus de 30 ans ?", "demo-30", [["rien","Je ne sais pas"],["oui","Oui"],["non","Non"]]);
            createSel("Plus de 65 ans ?", "demo-65", [["rien","Je ne sais pas"],["oui","Oui"],["non","Non"]]);
            createSel("Ant√©c√©dents familiaux ?", "demo-atcd", [["rien","Je ne sais pas"],["oui","Oui"],["non","Non"]]);
            createSel("Fumeur ?", "demo-tabac", [["rien","Je ne sais pas"],["oui","Oui"],["non","Non"]]);
            
            const btnGroup = document.createElement('div'); btnGroup.className='button-group';
            const btnStart = document.createElement('button'); btnStart.className='btn'; btnStart.textContent='‚ñ∂Ô∏è D√©marrer';
            btnStart.onclick=()=>{ 
            state.demo = {
                femme: q('#demo-sexe').value === 'femme', homme: q('#demo-sexe').value === 'homme',
                plus_de_30ans: q('#demo-30').value === 'oui', plus_de_65ans: q('#demo-65').value === 'oui',
                atcd_famille: q('#demo-atcd').value === 'oui', tabac: q('#demo-tabac').value === 'oui'
            };
            state.answers={}; state.asked=[]; state.diagnosticShown=false; state.previousDiagnostics=[]; state.history=[];
            state.confirmationMode = false; state.confirmationQueue = []; state.confirmedPatho = null;
            state.priorityQueue = [];
            askNextQuestion();
            };
            const btnCancel = document.createElement('button'); btnCancel.className='link'; btnCancel.textContent='Annuler'; btnCancel.onclick=renderHome;
            btnGroup.appendChild(btnStart); btnGroup.appendChild(btnCancel); card.appendChild(btnGroup); app.appendChild(card);
        }

        function prepareSigns() {
            let allSignsSet = new Set();
            PATHOLOGIES.forEach(p => { Object.keys(p.signes).forEach(s => allSignsSet.add(s)); });
            state.allSigns = Array.from(allSignsSet);
        }

        function rankPathologies() {
            const scores = PATHOLOGIES.map(p => {
                let score = 0;
                for(const facteur in p.facteurs){ if(state.demo[facteur] === true) score += p.facteurs[facteur]; }
                for(const signe in p.signes){
                    const ans = state.answers[signe];
                    if(ans === true) score += p.signes[signe];
                    else if(ans === false) score -= (p.signes[signe] * 0.5);
                }
                return {patho:p, score: Math.max(0, score)};
            });
            const totalScore = scores.reduce((sum, s) => sum + s.score, 0);
            state.ranked = scores.map(s => ({
                ...s, prob: totalScore > 0 ? ((s.score / totalScore) * 100).toFixed(1) : 0
            })).sort((a,b)=>b.prob - a.prob);
        }

        function getNextSmartSign(rankedPathos, remainingSigns) {
            if (rankedPathos.length < 2) return remainingSigns[Math.floor(Math.random() * remainingSigns.length)];
            
            const top1 = rankedPathos[0].patho;
            const top2 = rankedPathos[1].patho;
            
            let candidates = remainingSigns.map(s => {
                const w1 = top1.signes[s] || 0;
                const w2 = top2.signes[s] || 0;
                return { sign: s, score: Math.abs(w1 - w2) + (Math.random() * 0.1) };
            });

            candidates.sort((a, b) => b.score - a.score);
            let usefulCandidates = candidates.filter(c => c.score > 0.1);
            if (usefulCandidates.length === 0) usefulCandidates = candidates;

            const poolSize = Math.min(usefulCandidates.length, 5);
            const topPool = usefulCandidates.slice(0, poolSize);
            const winner = topPool[Math.floor(Math.random() * topPool.length)];
            
            return winner.sign;
        }

        function canShowDiagnostic() {
            const qNum = state.asked.length;
            if(state.ranked.length===0) return false;
            const top1 = state.ranked[0];
            const top2 = state.ranked[1];
            if(state.previousDiagnostics.includes(top1.patho.name)) return false;

            const score1 = parseFloat(top1.prob);
            if (!top2) return score1 > 50;

            const score2 = parseFloat(top2.prob);
            const gap = score1 - score2;

            if (qNum >= 4 && score1 >= 75 && gap >= 30) return true;
            if (qNum >= 9 && score1 >= 70 && gap >= 15) return true;
            if (qNum >= 15 && score1 >= 60) return true;

            return false;
        }

        function prepareConfirmationQuestions(topPatho) {
            const pSigns = Object.entries(topPatho.signes)
                .sort((a, b) => b[1] - a[1])
                .map(entry => entry[0]);
            const potential = pSigns.filter(s => !state.asked.includes(s));
            return potential.slice(0, 2);
        }

        function renderCurrentQuestion() {
            const app = q('#app'); app.innerHTML='';
            const card = document.createElement('div'); card.className='card center';
            const signe = state.currentSign;
            const questionTitle = state.confirmationMode ? 
                `<span style="color:var(--gold)">ü§î Je pense avoir une piste...</span>` : 
                `QUESTION ${state.asked.length}`;

            card.innerHTML=`<div class="small" style="margin-bottom:12px; color:var(--accent)">${questionTitle}</div>
                            <div class="question-text">Le patient pr√©sente-t-il :<br><strong style="font-size:1.2em; color:white;">${formatSigneName(signe)}</strong> ?</div>`;
            const btnGroup = document.createElement('div'); btnGroup.className='button-group';
            
            const mkBtn = (txt, cls, val) => {
                const b = document.createElement('button'); b.className=cls; b.textContent=txt;
                b.onclick=()=>{ 
                    state.history.push(JSON.stringify({
                        answers: state.answers, asked: state.asked, currentSign: state.currentSign,
                        confirmationMode: state.confirmationMode, confirmationQueue: state.confirmationQueue,
                        confirmedPatho: state.confirmedPatho, priorityQueue: state.priorityQueue
                    }));
                    state.answers[signe]=val; askNextQuestion(); 
                };
                btnGroup.appendChild(b);
            };
            mkBtn('OUI', 'btn btn-success', true);
            mkBtn('NON', 'btn btn-error', false);
            mkBtn('Je ne sais pas', 'link', null);
            card.appendChild(btnGroup);

            const navGroup = document.createElement('div'); navGroup.style.display = 'flex'; navGroup.style.gap = '15px'; navGroup.style.marginTop = '20px';
            if(state.history.length > 0) {
                const btnBack = document.createElement('button'); btnBack.className='btn-back'; btnBack.textContent='‚¨ÖÔ∏è Retour';
                btnBack.onclick = () => {
                    const prevState = JSON.parse(state.history.pop());
                    Object.assign(state, prevState);
                    renderCurrentQuestion();
                };
                navGroup.appendChild(btnBack);
            }
            const btnAb = document.createElement('button'); btnAb.className='link'; btnAb.textContent='Abandonner'; btnAb.onclick=renderHome;
            navGroup.appendChild(btnAb); card.appendChild(navGroup);
            app.appendChild(card);
        }

        function askNextQuestion() {
            if(state.asked.length > 0) {
                const lastSign = state.asked[state.asked.length - 1];
                const lastAnswer = state.answers[lastSign];
                if(lastAnswer === true) {
                    if(REFINEMENTS[lastSign]) {
                        const candidates = REFINEMENTS[lastSign].filter(s => state.allSigns.includes(s) && !state.asked.includes(s));
                        state.priorityQueue.push(...candidates);
                    } else {
                        for (const [parent, children] of Object.entries(REFINEMENTS)) {
                            if (children.includes(lastSign)) {
                                const siblings = children.filter(c => c !== lastSign);
                                state.priorityQueue = state.priorityQueue.filter(q => !siblings.includes(q));
                                state.asked.push(...siblings.filter(s => !state.asked.includes(s)));
                            }
                        }
                    }
                }
            }

            if(state.priorityQueue.length > 0) {
                const nextPriority = state.priorityQueue.shift();
                if(!state.asked.includes(nextPriority)) {
                    state.currentSign = nextPriority; state.asked.push(nextPriority); renderCurrentQuestion(); return;
                } else {
                    askNextQuestion(); return;
                }
            }

            if (state.confirmationMode) {
                const lastSign = state.asked[state.asked.length - 1];
                if (state.answers[lastSign] === false) {
                    state.confirmationMode = false; state.confirmationQueue = []; state.confirmedPatho = null;
                    showAlert("Ah, fausse piste. Je continue √† chercher...", "info");
                } else if (state.confirmationQueue.length > 0) {
                    const nextC = state.confirmationQueue.shift();
                    state.currentSign = nextC; state.asked.push(nextC); renderCurrentQuestion(); return;
                } else {
                    showDiagnostic(); return;
                }
            }

            prepareSigns();
            const remaining = state.allSigns.filter(s => !state.asked.includes(s));
            if(remaining.length === 0) { showDiagnostic(); return; }

            const hasSymptom = Object.keys(state.answers).some(key => state.answers[key] === true);
            if (!hasSymptom) {
                const generalSigns = remaining.filter(s => REFINEMENTS.hasOwnProperty(s));
                const pool = generalSigns.length > 0 ? generalSigns : remaining;
                const randomSign = pool[Math.floor(Math.random() * pool.length)];
                state.currentSign = randomSign; state.asked.push(randomSign); renderCurrentQuestion(); return;
            }

            rankPathologies(); 
            if(canShowDiagnostic()){ 
                const topPatho = state.ranked[0].patho;
                const confirmQuestions = prepareConfirmationQuestions(topPatho);
                if (confirmQuestions.length > 0) {
                    state.confirmationMode = true; state.confirmedPatho = topPatho; state.confirmationQueue = confirmQuestions;
                    const first = state.confirmationQueue.shift();
                    state.currentSign = first; state.asked.push(first); renderCurrentQuestion(); return;
                } else { showDiagnostic(); return; }
            }
            
            const signe = getNextSmartSign(state.ranked, remaining);
            state.currentSign = signe; state.asked.push(signe); renderCurrentQuestion();
        }

        function showDiagnostic() {
            const app = q('#app'); app.innerHTML = '';
            const loadingCard = document.createElement('div'); loadingCard.className = 'card center';
            loadingCard.innerHTML = `<h3 style="color:var(--accent)">üîé Analyse IA en cours...</h3><div style="margin: 30px 0; font-size: 50px; animation: spin 0.8s infinite linear;">‚öôÔ∏è</div><p class="small">Comparaison base de donn√©es...</p>`;
            app.appendChild(loadingCard);

            setTimeout(() => {
                rankPathologies();
                const top = state.ranked[0];
                state.diagnosticShown = true;
                state.previousDiagnostics.push(top.patho.name);

                app.innerHTML = ''; 
                const card = document.createElement('div'); card.className='card center';
                const title = document.createElement('h2'); title.textContent='üí° Diagnostic Propos√©'; card.appendChild(title);
                
                let pdfButton = top.patho.pdf && top.patho.pdf !== '#' ? `<a class="link" style="color:var(--accent); border-color:var(--accent); display:inline-block; margin-top:10px;" href="${top.patho.pdf}" target="_blank">üìÑ Voir fiche PDF</a>` : `<span class="small" style="opacity:0.5">üìÑ Pas de fiche PDF</span>`;
                
                const diagDiv = document.createElement('div'); diagDiv.className='diagnostic-result';
                diagDiv.innerHTML = `<div class="diagnostic-name">${top.patho.name}</div><div class="patho-desc" style="margin-top:8px">${top.patho.short}</div><br>${pdfButton}`;
                card.appendChild(diagDiv);
                
                const btnGroup = document.createElement('div'); btnGroup.className='button-group';
                
                const btnTrue = document.createElement('button'); btnTrue.className='btn btn-success'; btnTrue.textContent='‚úÖ Correct';
                btnTrue.onclick = async () => { 
                    triggerConfetti(); playSound('success');
                    state.progression.correct++; state.progression.streak = (state.progression.streak || 0) + 1;
                    if(!state.progression.mastery) state.progression.mastery = {};
                    const pName = top.patho.name;
                    if(!state.progression.mastery[pName]) state.progression.mastery[pName] = 0;
                    state.progression.mastery[pName]++;
                    updateHeader(); await saveProgression(); 
                    showAlert('Diagnostic valid√© !','success'); showDiagnosticDetails(top);
                };
                
                const btnFalse = document.createElement('button'); btnFalse.className='btn btn-error'; btnFalse.textContent='‚ùå Incorrect';
                btnFalse.onclick = async () => { 
                    playSound('error');
                    state.progression.incorrect++; state.progression.streak = 0;
                    updateHeader(); await saveProgression(); 
                    showAlert('A√Øe... Continuons','error'); 
                    state.confirmationMode = false; state.diagnosticShown=false; 
                    setTimeout(()=>askNextQuestion(), 800);
                };
                
                btnGroup.appendChild(btnTrue); btnGroup.appendChild(btnFalse); card.appendChild(btnGroup); app.appendChild(card);
            }, 1500);
        }

        function showDiagnosticDetails(top) {
            const app = q('#app'); app.innerHTML = '';
            const card = document.createElement('div'); card.className='card';
            
            const title = document.createElement('h2'); title.innerHTML = `‚úÖ ${top.patho.name}`; card.appendChild(title);
            const desc = document.createElement('div'); desc.className='patho-desc'; desc.textContent = top.patho.short; desc.style.marginBottom='20px'; desc.style.textAlign='center'; card.appendChild(desc);
            
            if(top.patho.signes) { // Check if called from deep link with full object
                const pathoSigns = Object.keys(top.patho.signes);
                const correctSigns = [], missingSigns = [], notAskedSigns = [], erroneousSigns = [];
                pathoSigns.forEach(s => {
                    const val = state.answers[s];
                    if(val === true) correctSigns.push(s); 
                    else if(val === false) missingSigns.push(s);
                    else notAskedSigns.push(s);
                });
                state.allSigns.forEach(s => { if(state.answers[s] === true && !pathoSigns.includes(s)) erroneousSigns.push(s); });
                
                const resultsDiv = document.createElement('div'); resultsDiv.className='result-list';
                const createList = (title, items, type, typeLabel) => {
                    if(items.length > 0) {
                        const h = document.createElement('h4'); h.textContent = `${title} (${items.length})`; h.style.marginTop='15px'; h.style.marginBottom='5px'; h.style.color='white'; resultsDiv.appendChild(h);
                        items.forEach(s => {
                            const r = document.createElement('div'); r.className='result-item result-'+type;
                            r.innerHTML = `<div>${formatSigneName(s)}</div><div style="opacity:0.7; font-size:0.85em; font-weight:600;">${typeLabel}</div>`;
                            resultsDiv.appendChild(r);
                        });
                    }
                };
                createList("‚úÖ Signes bien identifi√©s", correctSigns, "correct", "Valid√©");
                createList("‚ùå Signes manqu√©s (Faux N√©gatifs)", missingSigns, "missing", "Vous avez dit Non");
                createList("‚ÑπÔ∏è Autres signes du tableau clinique", notAskedSigns, "neutral", "Non demand√©");
                createList("‚ö†Ô∏è Signes coch√©s √† tort (Faux Positifs)", erroneousSigns, "error", "Erreur");
                card.appendChild(resultsDiv);
            }

            // PDF Button again if needed
            if(top.patho.pdf && top.patho.pdf !== '#') {
                const pdfBtn = document.createElement('a');
                pdfBtn.href = top.patho.pdf; pdfBtn.target = "_blank"; pdfBtn.className = 'btn'; pdfBtn.textContent = 'üìÑ Voir la fiche PDF compl√®te'; pdfBtn.style.marginTop = '20px'; pdfBtn.style.display = 'block'; pdfBtn.style.textAlign = 'center';
                card.appendChild(pdfBtn);
            }
            
            const btnGroup = document.createElement('div'); btnGroup.className='button-group';
            const btnHome = document.createElement('button'); btnHome.className='btn'; btnHome.textContent = 'üè† Retour Accueil'; btnHome.onclick = renderHome;
            btnGroup.appendChild(btnHome); card.appendChild(btnGroup); app.appendChild(card);
        }

        function renderGlossary() {
            const app = q('#app'); app.innerHTML='';
            const titleCard = document.createElement('div'); titleCard.className='card center'; titleCard.innerHTML='<h2>üìö Glossaire</h2>'; 
            const btnBack = document.createElement('button'); btnBack.className='link'; btnBack.textContent='üè† Retour';
            btnBack.style.marginBottom='20px'; btnBack.onclick=renderHome;
            titleCard.appendChild(btnBack); app.appendChild(titleCard);

            const searchContainer = document.createElement('div'); searchContainer.className = 'search-container';
            const searchInput = document.createElement('input'); searchInput.className = 'search-input'; searchInput.placeholder = 'üîç Rechercher une pathologie (ex: Grippe...)'; searchInput.type = 'text';
            searchContainer.appendChild(searchInput); app.appendChild(searchContainer);

            const wrapper = document.createElement('div'); wrapper.className = 'glossary-wrapper';
            const sidebar = document.createElement('div'); sidebar.className = 'alphabet-sidebar';
            const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
            const sortedPathos = [...PATHOLOGIES].sort((a, b) => a.name.localeCompare(b.name));
            const existingLetters = new Set(sortedPathos.map(p => p.name.charAt(0).toUpperCase()));
            
            alphabet.forEach(letter => {
                const link = document.createElement('a'); link.textContent = letter; link.className = 'alpha-link';
                if (existingLetters.has(letter)) {
                    link.href = `#letter-${letter}`;
                    link.onclick = (e) => { e.preventDefault(); const target = document.getElementById(`letter-${letter}`); if(target) target.scrollIntoView({behavior: 'smooth', block: 'start'}); };
                } else { link.classList.add('disabled'); }
                sidebar.appendChild(link);
            });
            wrapper.appendChild(sidebar);

            const content = document.createElement('div'); content.className = 'glossary-content';
            function renderGrid(pathos, showHeaders = true) {
                content.innerHTML = '';
                if(pathos.length === 0) { content.innerHTML = '<div style="text-align:center; padding:20px; color:var(--text-muted)">Aucune pathologie trouv√©e.</div>'; return; }
                if(!showHeaders) {
                    const grid = document.createElement('div'); grid.className = 'letter-grid';
                    pathos.forEach(p => { grid.appendChild(createPathoCard(p)); }); content.appendChild(grid);
                } else {
                    alphabet.forEach(letter => {
                        const letterPathos = pathos.filter(p => p.name.charAt(0).toUpperCase() === letter);
                        if(letterPathos.length > 0) {
                            const letterHeader = document.createElement('div'); letterHeader.className = 'letter-header'; letterHeader.id = `letter-${letter}`; letterHeader.textContent = letter; content.appendChild(letterHeader);
                            const grid = document.createElement('div'); grid.className = 'letter-grid';
                            letterPathos.forEach(p => { grid.appendChild(createPathoCard(p)); }); content.appendChild(grid);
                        }
                    });
                }
            }
            function createPathoCard(p) {
                const card = document.createElement('div'); card.className='patho-card';
                card.innerHTML=`<div class="patho-name">${p.name}</div><div class="patho-desc">${p.short}</div>`;
                card.onclick=()=>{ if(p.pdf && p.pdf !== '#') window.open(p.pdf,'_blank'); else showAlert('Fiche PDF non disponible','error'); };
                return card;
            }
            renderGrid(sortedPathos, true);
            searchInput.addEventListener('input', (e) => {
                const term = e.target.value.toLowerCase();
                if(term.length > 0) { sidebar.style.display = 'none'; const filtered = sortedPathos.filter(p => p.name.toLowerCase().includes(term)); renderGrid(filtered, false); } 
                else { sidebar.style.display = 'flex'; renderGrid(sortedPathos, true); }
            });
            wrapper.appendChild(content); app.appendChild(wrapper);
        }
    </script>
</body>
</html>
